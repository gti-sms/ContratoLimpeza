<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Completo - Materiais de Limpeza SMS</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a5276;
            --primary-dark: #13405c;
            --primary-light: #2e86c1;
            --secondary: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --light: #f8f9fa;
            --dark: #343a40;
            --gray: #6c757d;
            --light-gray: #e9ecef;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            min-height: 100vh;
            color: var(--dark);
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            padding: 1.5rem 2rem;
            border-radius: 10px 10px 0 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .logo {
            font-size: 2.5rem;
        }
        
        .header-text h1 {
            font-size: 1.8rem;
            margin-bottom: 0.25rem;
        }
        
        .dashboard {
            background: white;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .tabs {
            display: flex;
            background: var(--light);
            border-bottom: 1px solid var(--light-gray);
        }
        
        .tab {
            padding: 1rem 1.5rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
            background: white;
        }
        
        .tab-content {
            display: none;
            padding: 2rem;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: var(--light);
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border-left: 4px solid var(--primary);
        }
        
        .stat-card h3 {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .chart-container {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            height: 300px;
        }
        
        .table-container {
            margin-top: 2rem;
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--light-gray);
        }
        
        th {
            background: var(--primary);
            color: white;
            position: sticky;
            top: 0;
        }
        
        tr:hover {
            background: rgba(26, 82, 118, 0.05);
        }
        
        .status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .ok { background: #d4edda; color: #155724; }
        .warning { background: #fff3cd; color: #856404; }
        .danger { background: #f8d7da; color: #721c24; }
        
        .controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        select, button {
            padding: 0.7rem 1rem;
            border: 1px solid var(--light-gray);
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        select {
            background: white;
            min-width: 200px;
        }
        
        button {
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: background 0.3s ease;
        }
        
        button:hover {
            background: var(--primary-dark);
        }
        
        .unit-details {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2rem;
        }
        
        .units-list {
            background: var(--light);
            border-radius: 8px;
            padding: 1.5rem;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .unit-item {
            padding: 1rem;
            margin-bottom: 0.5rem;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid var(--primary);
        }
        
        .unit-item:hover {
            background: #e9ecef;
        }
        
        .unit-item.active {
            background: var(--primary-light);
            color: white;
        }
        
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .product-card {
            background: white;
            border: 1px solid var(--light-gray);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .product-name {
            font-weight: bold;
            color: var(--primary);
        }
        
        .product-data {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .data-item {
            margin-bottom: 0.5rem;
        }
        
        .data-label {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        .data-value {
            font-weight: bold;
        }
        
        .suggestions {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--light-gray);
        }
        
        .suggestion-item {
            background: #e7f3ff;
            padding: 0.5rem;
            border-radius: 4px;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        
        .ai-insights {
            background: #f0f8ff;
            border-left: 4px solid var(--primary);
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 2rem;
        }
        
        .insight-item {
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #d1e7ff;
        }
        
        .insight-item:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }
        
        footer {
            text-align: center;
            padding: 2rem;
            color: var(--gray);
            margin-top: 2rem;
        }
        
        .unit-type {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 0.5rem;
        }
        
        .type-ubs { background: #d4edda; color: #155724; }
        .type-cais { background: #cce7ff; color: #004085; }
        .type-demais { background: #f8d7da; color: #721c24; }
        
        /* Novos estilos para efici√™ncia de estoque */
        .efficiency-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .efficiency-stat-card {
            background: var(--light);
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .efficiency-stat-card.efficient {
            border-left: 4px solid var(--secondary);
        }
        
        .efficiency-stat-card.attention {
            border-left: 4px solid var(--warning);
        }
        
        .efficiency-stat-card.critical {
            border-left: 4px solid var(--danger);
        }
        
        .efficiency-stat-card h3 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .efficiency-stat-card.efficient h3 {
            color: var(--secondary);
        }
        
        .efficiency-stat-card.attention h3 {
            color: var(--warning);
        }
        
        .efficiency-stat-card.critical h3 {
            color: var(--danger);
        }
        
        .efficiency-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .efficiency-high {
            background: #d4edda;
            color: #155724;
        }
        
        .efficiency-medium {
            background: #fff3cd;
            color: #856404;
        }
        
        .efficiency-low {
            background: #f8d7da;
            color: #721c24;
        }
        
        .gauge-container {
            position: relative;
            width: 100%;
            height: 200px;
            margin: 0 auto;
        }
        
        .gauge-chart {
            width: 100%;
            height: 100%;
        }
        
        .ranking-table th:nth-child(3),
        .ranking-table td:nth-child(3) {
            text-align: center;
        }
        
        /* NOVOS ESTILOS PARA DETALHES DE PRODUTO */
        .product-detail-panel {
            display: none;
            background: white;
            border-radius: 8px;
            padding: 2rem;
            margin-top: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid var(--primary);
        }
        
        .product-detail-panel.active {
            display: block;
        }
        
        .product-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .product-detail-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .product-detail-stat {
            background: var(--light);
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
        }
        
        .product-detail-stat h3 {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .units-distribution {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 1rem;
        }
        
        .unit-distribution-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            margin-bottom: 0.5rem;
            background: var(--light);
            border-radius: 6px;
            border-left: 4px solid var(--primary);
        }
        
        .unit-distribution-info {
            flex: 1;
        }
        
        .unit-distribution-stock {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .stock-bar {
            width: 100px;
            height: 8px;
            background: var(--light-gray);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .stock-fill {
            height: 100%;
            border-radius: 4px;
        }
        
        .stock-fill.ok { background: var(--secondary); }
        .stock-fill.warning { background: var(--warning); }
        .stock-fill.danger { background: var(--danger); }
        
        .clickable-row {
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .clickable-row:hover {
            background-color: rgba(26, 82, 118, 0.1) !important;
        }
        
        .export-section {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border-left: 4px solid var(--primary);
        }
        
        .export-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }
        
        .export-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.7rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            transition: background 0.3s ease;
        }
        
        .export-btn:hover {
            background: var(--primary-dark);
        }
        
        .export-btn.warning {
            background: var(--warning);
            color: var(--dark);
        }
        
        .export-btn.warning:hover {
            background: #e0a800;
        }
        
        .export-btn.danger {
            background: var(--danger);
        }
        
        .export-btn.danger:hover {
            background: #c82333;
        }
        
        .suggestion-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }
        
        .suggestion-card {
            background: white;
            border: 1px solid var(--light-gray);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .suggestion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .respondent-info {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--light-gray);
        }
        
        .respondent-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .respondent-details {
            flex: 1;
        }
        
        .respondent-name {
            font-weight: bold;
            margin-bottom: 0.25rem;
        }
        
        .respondent-role {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        .suggestion-date {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        .supplier-issues {
            background: #fff3cd;
            border-left: 4px solid var(--warning);
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 2rem;
        }
        
        .issue-item {
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #ffeaa7;
        }
        
        .issue-item:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 1200px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .stats, .efficiency-stats, .product-detail-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .unit-details, .suggestion-details {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .stats, .efficiency-stats, .product-detail-stats {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1;
                min-width: 120px;
                text-align: center;
            }
            
            .export-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
        <p>Carregando dados...</p>
    </div>

    <div class="container" id="main-content">
        <header>
            <div class="header-content">
                <div class="logo-container">
                    <i class="fas fa-hand-holding-medical logo"></i>
                    <div class="header-text">
                        <h1>Painel Completo - Materiais de Limpeza</h1>
                        <p>Secretaria Municipal de Sa√∫de - Vis√£o Consolidada de Todas as Unidades</p>
                    </div>
                </div>
                <div class="header-stats">
                    <div style="text-align: center;">
                        <div style="font-size: 1.5rem; font-weight: bold;" id="totalUnits">55</div>
                        <div style="font-size: 0.8rem;">Unidades Monitoradas</div>
                    </div>
                </div>
            </div>
        </header>
        
        <div class="dashboard">
            <div class="tabs">
                <div class="tab active" data-tab="overview">Vis√£o Geral</div>
                <div class="tab" data-tab="efficiency">Efici√™ncia de Estoque</div>
                <div class="tab" data-tab="units">Unidades</div>
                <div class="tab" data-tab="products">Produtos</div>
                <div class="tab" data-tab="suggestions">Sugest√µes</div>
                <div class="tab" data-tab="analysis">An√°lise IA</div>
            </div>
            
            <div class="tab-content active" id="overview">
                <div class="export-section">
                    <h3><i class="fas fa-file-export"></i> Exportar Relat√≥rios</h3>
                    <p>Gere relat√≥rios em PDF para documenta√ß√£o oficial e auditoria</p>
                    <div class="export-buttons">
                        <button class="export-btn" id="exportOverview">
                            <i class="fas fa-file-pdf"></i> Exportar Vis√£o Geral
                        </button>
                        <button class="export-btn warning" id="exportCritical">
                            <i class="fas fa-exclamation-triangle"></i> Exportar Situa√ß√£o Cr√≠tica
                        </button>
                        <button class="export-btn danger" id="exportSupplierIssues">
                            <i class="fas fa-truck-loading"></i> Exportar Problemas com Fornecedor
                        </button>
                    </div>
                </div>
                
                <div class="controls">
                    <select id="filterType">
                        <option value="all">Todos os Tipos</option>
                        <option value="UBS">UBS</option>
                        <option value="CAIS">CAIS</option>
                        <option value="DEMAIS">Demais</option>
                    </select>
                    <button id="refreshData">
                        <i class="fas fa-sync-alt"></i> Atualizar Dados em Tempo Real
                    </button>
                </div>
                
                <div class="stats">
                    <div class="stat-card">
                        <h3 id="totalUnitsCount">55</h3>
                        <p>Unidades de Sa√∫de</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalProductsCount">23</h3>
                        <p>Tipos de Produtos</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="criticalAlerts">18</h3>
                        <p>Alertas Cr√≠ticos</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="suggestionsCount">42</h3>
                        <p>Sugest√µes Recebidas</p>
                    </div>
                </div>
                
                <div class="charts-grid">
                    <div class="chart-container">
                        <h3>Status do Estoque por Unidade (Top 10)</h3>
                        <canvas id="statusChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Produtos Mais Faltantes</h3>
                        <canvas id="productsChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Distribui√ß√£o por Tipo de Unidade</h3>
                        <canvas id="typeChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Evolu√ß√£o de Alertas (√öltimos 6 Meses)</h3>
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>
                
                <div class="table-container">
                    <h3>Top 10 Unidades com Mais Solicita√ß√µes</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Unidade</th>
                                <th>Tipo</th>
                                <th>Produtos Cr√≠ticos</th>
                                <th>Produtos em Aten√ß√£o</th>
                                <th>Sugest√µes</th>
                                <th>Status Geral</th>
                                <th>√öltima Atualiza√ß√£o</th>
                            </tr>
                        </thead>
                        <tbody id="summaryTableBody">
                            <!-- Dados preenchidos via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="tab-content" id="efficiency">
                <h2><i class="fas fa-chart-line"></i> Efici√™ncia de Estoque por Unidade</h2>
                <p class="data-label" style="margin-bottom: 1.5rem;">An√°lise da adequa√ß√£o entre materiais disponibilizados e necessidades m√≠nimas sugeridas</p>
                
                <div class="efficiency-stats">
                    <div class="efficiency-stat-card efficient">
                        <h3 id="efficientUnits">0</h3>
                        <p>Unidades Eficientes</p>
                        <small>Efici√™ncia ‚â• 90%</small>
                    </div>
                    <div class="efficiency-stat-card attention">
                        <h3 id="attentionUnits">0</h3>
                        <p>Unidades em Aten√ß√£o</p>
                        <small>Efici√™ncia 70-89%</small>
                    </div>
                    <div class="efficiency-stat-card critical">
                        <h3 id="criticalUnits">0</h3>
                        <p>Unidades Cr√≠ticas</p>
                        <small>Efici√™ncia < 70%</small>
                    </div>
                </div>
                
                <div class="charts-grid">
                    <div class="chart-container">
                        <h3>Distribui√ß√£o da Efici√™ncia</h3>
                        <canvas id="efficiencyDistributionChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Top 10 Unidades Mais Eficientes</h3>
                        <canvas id="topEfficiencyChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Top 10 Unidades Menos Eficientes</h3>
                        <canvas id="bottomEfficiencyChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Efici√™ncia M√©dia por Tipo de Unidade</h3>
                        <canvas id="efficiencyByTypeChart"></canvas>
                    </div>
                </div>
                
                <div class="table-container">
                    <h3>Ranking de Efici√™ncia por Unidade</h3>
                    <table class="ranking-table">
                        <thead>
                            <tr>
                                <th>Posi√ß√£o</th>
                                <th>Unidade</th>
                                <th>Tipo</th>
                                <th>Efici√™ncia</th>
                                <th>Status</th>
                                <th>Produtos Analisados</th>
                            </tr>
                        </thead>
                        <tbody id="efficiencyTableBody">
                            <!-- Dados preenchidos via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="tab-content" id="units">
                <div class="unit-details">
                    <div class="units-list">
                        <h3>Lista de Unidades</h3>
                        <div id="unitsListContainer">
                            <!-- Lista de unidades preenchida via JavaScript -->
                        </div>
                    </div>
                    
                    <div class="unit-details-content">
                        <h3 id="selectedUnitName">Selecione uma unidade para ver detalhes</h3>
                        <div id="unitProductsGrid" class="product-grid">
                            <!-- Produtos da unidade selecionada -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="products">
                <div class="controls">
                    <select id="filterProduct">
                        <option value="all">Todos os Produtos</option>
                        <!-- Op√ß√µes preenchidas via JavaScript -->
                    </select>
                    <button id="refreshProducts">
                        <i class="fas fa-sync-alt"></i> Atualizar Dados
                    </button>
                </div>
                
                <div class="table-container">
                    <h3>Detalhamento por Produto</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Produto</th>
                                <th>Total Dispon√≠vel</th>
                                <th>Total M√≠nimo Sugerido</th>
                                <th>Unidades com Estoque Baixo</th>
                                <th>Unidades com Estoque Cr√≠tico</th>
                                <th>Status Geral</th>
                            </tr>
                        </thead>
                        <tbody id="productsTableBody">
                            <!-- Dados preenchidos via JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <!-- NOVO PAINEL DE DETALHES DO PRODUTO -->
                <div class="product-detail-panel" id="productDetailPanel">
                    <div class="product-detail-header">
                        <h2 id="selectedProductName">Detalhes do Produto</h2>
                        <button class="export-btn" id="exportProductDetail">
                            <i class="fas fa-file-pdf"></i> Exportar Detalhes
                        </button>
                    </div>
                    
                    <div class="product-detail-stats">
                        <div class="product-detail-stat">
                            <h3 id="detailTotalStock">0</h3>
                            <p>Total em Estoque</p>
                        </div>
                        <div class="product-detail-stat">
                            <h3 id="detailTotalMin">0</h3>
                            <p>M√≠nimo Sugerido</p>
                        </div>
                        <div class="product-detail-stat">
                            <h3 id="detailLowStock">0</h3>
                            <p>Unidades com Baixo Estoque</p>
                        </div>
                        <div class="product-detail-stat">
                            <h3 id="detailCriticalStock">0</h3>
                            <p>Unidades Cr√≠ticas</p>
                        </div>
                    </div>
                    
                    <div class="charts-grid">
                        <div class="chart-container">
                            <h3>Distribui√ß√£o por Unidade</h3>
                            <canvas id="productDistributionChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <h3>Status do Estoque</h3>
                            <canvas id="productStatusChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <h3>Distribui√ß√£o por Unidade</h3>
                        <div class="units-distribution" id="unitsDistribution">
                            <!-- Lista de unidades preenchida via JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="suggestions">
                <h2><i class="fas fa-comments"></i> Sugest√µes das Unidades</h2>
                <p class="data-label" style="margin-bottom: 1.5rem;">Sugest√µes enviadas pelas unidades com detalhes dos respondentes</p>
                
                <div class="suggestion-details">
                    <div class="suggestion-card">
                        <h3>√öltimas Sugest√µes Recebidas</h3>
                        <div id="suggestionsList">
                            <!-- Lista de sugest√µes preenchida via JavaScript -->
                        </div>
                    </div>
                    
                    <div class="suggestion-card">
                        <h3>Detalhes do Respondente</h3>
                        <div id="respondentDetails">
                            <!-- Detalhes do respondente preenchidos via JavaScript -->
                        </div>
                    </div>
                </div>
                
                <div class="supplier-issues">
                    <h3><i class="fas fa-exclamation-triangle"></i> Problemas Identificados com Fornecedor</h3>
                    <div id="supplierIssuesList">
                        <!-- Lista de problemas com fornecedor preenchida via JavaScript -->
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="analysis">
                <h2>An√°lises e Insights por IA</h2>
                
                <div class="ai-insights">
                    <h3><i class="fas fa-robot"></i> Insights Inteligentes</h3>
                    
                    <div class="insight-item">
                        <h4>üìä Padr√µes de Consumo Identificados</h4>
                        <p>As unidades do tipo CAIS apresentam 25% mais consumo de √ÅLCOOL 70% em compara√ß√£o com UBS. Recomenda-se ajuste na distribui√ß√£o.</p>
                    </div>
                    
                    <div class="insight-item">
                        <h4>üö® Alertas Priorit√°rios</h4>
                        <p>5 unidades est√£o com estoque cr√≠tico de m√∫ltiplos produtos simultaneamente: UBS Petr√≥polis, UBS Independente, Ambulat√≥rio Bela Vista, Cais H√≠pica e UBS Jardim Am√©rica.</p>
                    </div>
                    
                    <div class="insight-item">
                        <h4>üí° Sugest√µes Consolidadas</h4>
                        <p>As sugest√µes mais frequentes s√£o: "Escova para limpeza dos panos" (12 unidades), "Luvas de borracha" (8 unidades) e "Baldes adicionais" (6 unidades).</p>
                    </div>
                    
                    <div class="insight-item">
                        <h4>üìà Tend√™ncias e Previs√µes</h4>
                        <p>Com base no hist√≥rico, h√° tend√™ncia de aumento de 15% no consumo de DESINFETANTE para o pr√≥ximo trimestre. Recomenda-se planejamento antecipado.</p>
                    </div>
                    
                    <div class="insight-item">
                        <h4>üí∞ Otimiza√ß√£o de Recursos</h4>
                        <p>Identificado potencial de economia de 18% atrav√©s da padroniza√ß√£o de pedidos entre unidades do mesmo tipo.</p>
                    </div>
                </div>
                
                <div class="charts-grid" style="margin-top: 2rem;">
                    <div class="chart-container">
                        <h3>Efici√™ncia de Estoque por Tipo</h3>
                        <canvas id="efficiencyChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Correla√ß√£o entre Produtos</h3>
                        <canvas id="correlationChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Secretaria Municipal de Sa√∫de &copy; 2025 - Sistema de Controle de Materiais de Limpeza</p>
            <p>Painel de Monitoramento Completo - Dados em Tempo Real</p>
        </footer>
    </div>

    <script>
        // Vari√°veis globais
        let unitsData = [];
        let charts = {};
        let currentFilter = 'all';
        let currentSelectedProduct = null;

        // Dados completos de exemplo
        const productsList = [
            "√ÅGUA SANIT√ÅRIA 5L", "√ÅLCOOL IL 70%", "AROMATIZADOR AR AGRAD√ÅVEL 400ML", 
            "DESINFETANTE 5L", "DETERGENTE 500ML", "DETERGENTE 5L COLORADO",
            "ESPONJA DUPLA FACE 70X100", "FLANELA (30X40) BRANCA", "LUSTRA M√ìVEIS 200ML",
            "PANO DE CH√ÉO ALVEJADO 40X62", "PANO DE PRATO 45X75", "SAB√ÉO EM P√ì 1 KG",
            "SACO DE LIXO 100L 0,08 C/100", "SACO DE LIXO 20L 0,04 C/100", "SACO DE LIXO 60L 0,06 C/100",
            "SAP√ìLIO CREMOSO 250ML", "VASSOURA DE NYLON", "PASSADOR DE CERA",
            "RODO DE PL√ÅSTICO DUPLO 40CM", "P√Å DE LIXO PL√ÅSTICA CABO LONGO", 
            "ESCOVA SANIT√ÅRIA DE PL√ÅSTICO C/SUPORTE", "BALDE 08L PL√ÅSTICO", "CERA"
        ];

        // Dados de exemplo para respondentes
        const respondents = [
            { id: 1, name: "Maria Silva", role: "Enfermeira Chefe", unit: "UBS Petr√≥polis", avatar: "MS" },
            { id: 2, name: "Jo√£o Santos", role: "Administrador", unit: "Cais H√≠pica", avatar: "JS" },
            { id: 3, name: "Ana Oliveira", role: "Coordenadora", unit: "UBS Independente", avatar: "AO" },
            { id: 4, name: "Pedro Costa", role: "Gerente", unit: "Ambulat√≥rio Bela Vista", avatar: "PC" },
            { id: 5, name: "Carla Mendes", role: "Supervisora", unit: "UBS Jardim Am√©rica", avatar: "CM" }
        ];

        // Dados de exemplo para sugest√µes
        const suggestionsData = [
            {
                id: 1,
                unit: "UBS Petr√≥polis",
                product: "√ÅLCOOL IL 70%",
                suggestion: "Necessitamos de mais √°lcool 70% para higieniza√ß√£o das √°reas de atendimento. O consumo aumentou 30% nos √∫ltimos meses.",
                date: "2025-03-15",
                respondentId: 1
            },
            {
                id: 2,
                unit: "Cais H√≠pica",
                product: "SACO DE LIXO 100L",
                suggestion: "Sacos de lixo de 100L est√£o em falta h√° 3 semanas. Estamos usando sacos menores, o que aumenta o trabalho da equipe.",
                date: "2025-03-14",
                respondentId: 2
            }
        ];

        // Lista de unidades
        const unitNames = [
            "Ambulat√≥rio Bela Vista", "Ambulat√≥rio Capinzal", "Ambulat√≥rio Especialidades", 
            "Ambulat√≥rio Pulador", "Ambulat√≥rio S√£o Valentin/S√£o Roque",
            "Cais Dr. Ant√¥nio Marinho Albuquerque ‚Äì Vila Lu√≠za", "Cais Dr. Cyrio Nacul ‚Äì Petr√≥polis",
            "Cais Dr. Erwin Crussius ‚Äì H√≠pica", "Cais Dr. Lu√≠s Augusto Hexsel ‚Äì Boqueir√£o",
            "Cais Dr. Lu√≠s Fragomeni ‚Äì S√£o Crist√≥v√£o", "Caps Ad", "Caps I", "Caps II",
            "Central de Vacinas", "Centro de Refer√™ncia de Sa√∫de da Mulher",
            "Centro de Refer√™ncia de Sa√∫de do Idoso", "Capne", "Coordenadoria de Vigil√¢ncia em Sa√∫de",
            "UBS 1¬∫ Centen√°rio", "UBS Adirbal Corralo", "UBS Adolfo Groth", "UBS Adriana Lirio ‚Äì Oper√°ria",
            "UBS Edu Villa de Azambuja (Caic)", "UBS Jaboticabal", "UBS Jer√¥nimo Coelho",
            "UBS Planaltina", "UBS Ricci", "UBS Santa Marta / UBS Don√°ria", "UBS S√£o Crist√≥v√£o",
            "UBS S√£o Luiz Gonzaga", "Farm√°cia Central", "SAMU", "Secretaria Municipal De Sa√∫de",
            "Servi√ßo de Atendimento Especializado ‚Äì SAE", "UBS Annes", "UBS Bom Recreio",
            "UBS Entre Rios", "UBS Independente", "UBS Ivo Ferreira", "UBS Nossa Senhora Aparecida",
            "UBS Parque Farroupilha", "UBS Petr√≥polis", "UBS Santa Rita", 
            "UBS Santo Ant√¥nio Da Pedreira", "UBS Vila Nova", "Ambulat√≥rio Sede Independ√™ncia",
            "UBS H√≠pica", "UBS Mattos", "UBS Nene Graef", "UBS S√£o Jos√©", "UBS Valinhos",
            "UBS Zachia", "UBS Jardim Am√©rica", "UBS Menino Deus", "UBS Nonoai", "UBS Prisional"
        ];

        // Fun√ß√£o para gerar dados iniciais
        function generateInitialData() {
            unitsData = [];
            
            unitNames.forEach((name, index) => {
                const unitType = name.includes("UBS") ? "UBS" : 
                                name.includes("Cais") ? "CAIS" : "DEMAIS";
                
                const products = {};
                productsList.forEach(product => {
                    const random = Math.random();
                    let status, current, min;
                    
                    if (random < 0.2) {
                        status = "danger";
                        current = Math.floor(Math.random() * 2);
                        min = Math.floor(Math.random() * 5) + 5;
                    } else if (random < 0.5) {
                        status = "warning";
                        current = Math.floor(Math.random() * 3) + 2;
                        min = Math.floor(Math.random() * 5) + 5;
                    } else {
                        status = "ok";
                        current = Math.floor(Math.random() * 10) + 5;
                        min = Math.floor(Math.random() * 5) + 5;
                    }
                    
                    products[product] = {
                        current: current,
                        min: min,
                        status: status
                    };
                });
                
                unitsData.push({
                    id: index + 1,
                    name: name,
                    type: unitType,
                    products: products,
                    suggestions: Math.floor(Math.random() * 5),
                    lastUpdate: new Date(Date.now() - Math.floor(Math.random() * 7) * 24 * 60 * 60 * 1000).toLocaleDateString('pt-BR')
                });
            });
        }

        // Fun√ß√£o para mostrar/ocultar loading
        function toggleLoading(show) {
            const loading = document.getElementById('loading');
            const mainContent = document.getElementById('main-content');
            
            if (show) {
                loading.style.display = 'block';
                mainContent.style.display = 'none';
            } else {
                loading.style.display = 'none';
                mainContent.style.display = 'block';
            }
        }

        // Fun√ß√£o para inicializar o dashboard
        function initDashboard() {
            toggleLoading(true);
            
            setTimeout(() => {
                generateInitialData();
                setupEventListeners();
                updateStats();
                renderCharts();
                renderUnitsList();
                renderProductsTable();
                renderSummaryTable();
                renderEfficiencyData();
                renderSuggestions();
                initializeAnalysisCharts();
                toggleLoading(false);
            }, 1000);
        }

        // Atualizar estat√≠sticas gerais
        function updateStats() {
            document.getElementById('totalUnitsCount').textContent = unitsData.length;
            document.getElementById('totalProductsCount').textContent = productsList.length;
            
            let criticalCount = 0;
            unitsData.forEach(unit => {
                Object.values(unit.products).forEach(product => {
                    if (product.status === "danger") criticalCount++;
                });
            });
            document.getElementById('criticalAlerts').textContent = criticalCount;
            
            document.getElementById('suggestionsCount').textContent = suggestionsData.length;
        }

        // Renderizar gr√°ficos
        function renderCharts(filterType = 'all') {
            // Destruir gr√°ficos existentes
            Object.values(charts).forEach(chart => {
                if (chart && typeof chart.destroy === 'function') {
                    chart.destroy();
                }
            });
            charts = {};
            
            // Filtrar unidades se necess√°rio
            let filteredUnits = unitsData;
            if (filterType !== 'all') {
                filteredUnits = unitsData.filter(unit => unit.type === filterType);
            }
            
            // Gr√°fico de status por unidade (Top 10)
            const statusCtx = document.getElementById('statusChart').getContext('2d');
            const topUnits = [...filteredUnits].sort((a, b) => {
                const aCritical = Object.values(a.products).filter(p => p.status === "danger").length;
                const bCritical = Object.values(b.products).filter(p => p.status === "danger").length;
                return bCritical - aCritical;
            }).slice(0, 10);
            
            charts.statusChart = new Chart(statusCtx, {
                type: 'bar',
                data: {
                    labels: topUnits.map(u => u.name.substring(0, 15) + '...'),
                    datasets: [
                        {
                            label: 'Cr√≠tico',
                            data: topUnits.map(u => Object.values(u.products).filter(p => p.status === "danger").length),
                            backgroundColor: '#dc3545'
                        },
                        {
                            label: 'Aten√ß√£o',
                            data: topUnits.map(u => Object.values(u.products).filter(p => p.status === "warning").length),
                            backgroundColor: '#ffc107'
                        },
                        {
                            label: 'OK',
                            data: topUnits.map(u => Object.values(u.products).filter(p => p.status === "ok").length),
                            backgroundColor: '#28a745'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Gr√°fico de produtos mais faltantes
            const productsCtx = document.getElementById('productsChart').getContext('2d');
            const productCriticalCount = {};
            
            productsList.forEach(product => {
                productCriticalCount[product] = filteredUnits.filter(unit => 
                    unit.products[product] && unit.products[product].status === "danger"
                ).length;
            });
            
            const sortedProducts = Object.entries(productCriticalCount)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 8);
            
            charts.productsChart = new Chart(productsCtx, {
                type: 'bar',
                data: {
                    labels: sortedProducts.map(p => p[0]),
                    datasets: [{
                        label: 'Unidades com Estoque Cr√≠tico',
                        data: sortedProducts.map(p => p[1]),
                        backgroundColor: '#dc3545'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y'
                }
            });
            
            // Gr√°fico de distribui√ß√£o por tipo de unidade
            const typeCtx = document.getElementById('typeChart').getContext('2d');
            const typeCount = {
                'UBS': unitsData.filter(u => u.type === 'UBS').length,
                'CAIS': unitsData.filter(u => u.type === 'CAIS').length,
                'DEMAIS': unitsData.filter(u => u.type === 'DEMAIS').length
            };
            
            charts.typeChart = new Chart(typeCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(typeCount),
                    datasets: [{
                        data: Object.values(typeCount),
                        backgroundColor: ['#1a5276', '#2e86c1', '#85c1e9']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
            
            // Gr√°fico de tend√™ncia
            const trendCtx = document.getElementById('trendChart').getContext('2d');
            charts.trendChart = new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: ['Set', 'Out', 'Nov', 'Dez', 'Jan', 'Fev'],
                    datasets: [{
                        label: 'Alertas Cr√≠ticos',
                        data: [12, 19, 15, 17, 16, 18],
                        borderColor: '#dc3545',
                        tension: 0.3
                    }, {
                        label: 'Alertas de Aten√ß√£o',
                        data: [25, 22, 28, 30, 26, 24],
                        borderColor: '#ffc107',
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // Renderizar lista de unidades
        function renderUnitsList() {
            const container = document.getElementById('unitsListContainer');
            container.innerHTML = '';
            
            unitsData.forEach(unit => {
                const criticalCount = Object.values(unit.products).filter(p => p.status === "danger").length;
                const attentionCount = Object.values(unit.products).filter(p => p.status === "warning").length;
                
                const unitElement = document.createElement('div');
                unitElement.className = 'unit-item';
                unitElement.innerHTML = `
                    <div style="font-weight: bold;">${unit.name}</div>
                    <div style="display: flex; justify-content: space-between; margin-top: 0.5rem;">
                        <span class="unit-type type-${unit.type.toLowerCase()}">${unit.type}</span>
                        <div>
                            <span class="status danger" style="margin-right: 0.5rem;">${criticalCount} cr√≠tico(s)</span>
                            <span class="status warning">${attentionCount} aten√ß√£o</span>
                        </div>
                    </div>
                `;
                
                unitElement.addEventListener('click', () => showUnitDetails(unit));
                container.appendChild(unitElement);
            });
        }

        // Mostrar detalhes da unidade selecionada
        function showUnitDetails(unit) {
            document.getElementById('selectedUnitName').textContent = unit.name;
            
            const container = document.getElementById('unitProductsGrid');
            container.innerHTML = '';
            
            Object.entries(unit.products).forEach(([product, data]) => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                
                productCard.innerHTML = `
                    <div class="product-header">
                        <div class="product-name">${product}</div>
                        <span class="status ${data.status}">${
                            data.status === 'ok' ? 'Normal' : 
                            data.status === 'warning' ? 'Aten√ß√£o' : 'Cr√≠tico'
                        }</span>
                    </div>
                    <div class="product-data">
                        <div class="data-item">
                            <div class="data-label">Quantidade Atual</div>
                            <div class="data-value">${data.current}</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">M√≠nimo Sugerido</div>
                            <div class="data-value">${data.min}</div>
                        </div>
                    </div>
                `;
                
                container.appendChild(productCard);
            });
            
            // Ativar visualmente a unidade selecionada
            document.querySelectorAll('.unit-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
        }

        // Renderizar tabela de produtos
        function renderProductsTable() {
            const container = document.getElementById('productsTableBody');
            container.innerHTML = '';
            
            const filterProduct = document.getElementById('filterProduct');
            // Limpar op√ß√µes existentes (exceto a primeira)
            while (filterProduct.children.length > 1) {
                filterProduct.removeChild(filterProduct.lastChild);
            }
            
            productsList.forEach(product => {
                // Adicionar op√ß√£o ao filtro
                const option = document.createElement('option');
                option.value = product;
                option.textContent = product;
                filterProduct.appendChild(option);
                
                // Calcular estat√≠sticas do produto
                const totalCurrent = unitsData.reduce((sum, unit) => 
                    sum + (unit.products[product] ? unit.products[product].current : 0), 0);
                
                const totalMin = unitsData.reduce((sum, unit) => 
                    sum + (unit.products[product] ? unit.products[product].min : 0), 0);
                
                const lowStockUnits = unitsData.filter(unit => 
                    unit.products[product] && unit.products[product].status === "warning").length;
                
                const criticalUnits = unitsData.filter(unit => 
                    unit.products[product] && unit.products[product].status === "danger").length;
                
                let status = "ok";
                if (criticalUnits > 5) status = "danger";
                else if (criticalUnits > 0 || lowStockUnits > 10) status = "warning";
                
                const row = document.createElement('tr');
                row.className = 'clickable-row';
                row.innerHTML = `
                    <td><strong>${product}</strong></td>
                    <td>${totalCurrent}</td>
                    <td>${totalMin}</td>
                    <td>${lowStockUnits}</td>
                    <td>${criticalUnits}</td>
                    <td><span class="status ${status}">${
                        status === 'ok' ? 'Normal' : 
                        status === 'warning' ? 'Aten√ß√£o' : 'Cr√≠tico'
                    }</span></td>
                `;
                
                // Adicionar evento de clique para mostrar detalhes
                row.addEventListener('click', () => showProductDetails(product));
                
                container.appendChild(row);
            });
        }

        // NOVA FUN√á√ÉO: Mostrar detalhes do produto
        function showProductDetails(productName) {
            currentSelectedProduct = productName;
            
            // Mostrar painel de detalhes
            const panel = document.getElementById('productDetailPanel');
            panel.classList.add('active');
            
            // Atualizar t√≠tulo
            document.getElementById('selectedProductName').textContent = productName;
            
            // Calcular estat√≠sticas detalhadas
            let totalStock = 0;
            let totalMin = 0;
            let lowStockCount = 0;
            let criticalStockCount = 0;
            let unitsWithProduct = [];
            
            unitsData.forEach(unit => {
                if (unit.products[productName]) {
                    const product = unit.products[productName];
                    totalStock += product.current;
                    totalMin += product.min;
                    
                    if (product.status === "warning") lowStockCount++;
                    if (product.status === "danger") criticalStockCount++;
                    
                    unitsWithProduct.push({
                        unit: unit,
                        product: product
                    });
                }
            });
            
            // Atualizar estat√≠sticas
            document.getElementById('detailTotalStock').textContent = totalStock;
            document.getElementById('detailTotalMin').textContent = totalMin;
            document.getElementById('detailLowStock').textContent = lowStockCount;
            document.getElementById('detailCriticalStock').textContent = criticalStockCount;
            
            // Renderizar gr√°ficos
            renderProductDetailCharts(productName, unitsWithProduct);
            
            // Renderizar lista de unidades
            renderUnitsDistribution(unitsWithProduct);
            
            // Rolagem suave para o painel
            panel.scrollIntoView({ behavior: 'smooth' });
        }

        // NOVA FUN√á√ÉO: Renderizar gr√°ficos de detalhes do produto
        function renderProductDetailCharts(productName, unitsWithProduct) {
            // Destruir gr√°ficos existentes
            if (charts.productDistributionChart) {
                charts.productDistributionChart.destroy();
            }
            if (charts.productStatusChart) {
                charts.productStatusChart.destroy();
            }
            
            // Gr√°fico de distribui√ß√£o por unidade (Top 15)
            const distributionCtx = document.getElementById('productDistributionChart').getContext('2d');
            const topUnits = [...unitsWithProduct]
                .sort((a, b) => b.product.current - a.product.current)
                .slice(0, 15);
            
            charts.productDistributionChart = new Chart(distributionCtx, {
                type: 'bar',
                data: {
                    labels: topUnits.map(u => u.unit.name.substring(0, 15) + '...'),
                    datasets: [{
                        label: `Estoque de ${productName}`,
                        data: topUnits.map(u => u.product.current),
                        backgroundColor: topUnits.map(u => 
                            u.product.status === 'danger' ? '#dc3545' : 
                            u.product.status === 'warning' ? '#ffc107' : '#28a745'
                        )
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Gr√°fico de status do estoque
            const statusCtx = document.getElementById('productStatusChart').getContext('2d');
            const statusCount = {
                'Normal': unitsWithProduct.filter(u => u.product.status === 'ok').length,
                'Aten√ß√£o': unitsWithProduct.filter(u => u.product.status === 'warning').length,
                'Cr√≠tico': unitsWithProduct.filter(u => u.product.status === 'danger').length
            };
            
            charts.productStatusChart = new Chart(statusCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(statusCount),
                    datasets: [{
                        data: Object.values(statusCount),
                        backgroundColor: ['#28a745', '#ffc107', '#dc3545']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // NOVA FUN√á√ÉO: Renderizar distribui√ß√£o por unidades
        function renderUnitsDistribution(unitsWithProduct) {
            const container = document.getElementById('unitsDistribution');
            container.innerHTML = '';
            
            // Ordenar unidades por quantidade (maior para menor)
            const sortedUnits = [...unitsWithProduct].sort((a, b) => b.product.current - a.product.current);
            
            sortedUnits.forEach(item => {
                const unit = item.unit;
                const product = item.product;
                
                const percentage = (product.current / product.min) * 100;
                let fillClass = 'ok';
                if (percentage < 70) fillClass = 'danger';
                else if (percentage < 100) fillClass = 'warning';
                
                const distributionItem = document.createElement('div');
                distributionItem.className = 'unit-distribution-item';
                distributionItem.innerHTML = `
                    <div class="unit-distribution-info">
                        <div><strong>${unit.name}</strong> <span class="unit-type type-${unit.type.toLowerCase()}">${unit.type}</span></div>
                        <div style="font-size: 0.8rem; color: var(--gray);">
                            ${product.current} de ${product.min} unidades
                        </div>
                    </div>
                    <div class="unit-distribution-stock">
                        <div class="stock-bar">
                            <div class="stock-fill ${fillClass}" style="width: ${Math.min(percentage, 100)}%"></div>
                        </div>
                        <span class="status ${product.status}">${
                            product.status === 'ok' ? 'Normal' : 
                            product.status === 'warning' ? 'Aten√ß√£o' : 'Cr√≠tico'
                        }</span>
                    </div>
                `;
                
                container.appendChild(distributionItem);
            });
        }

        // Renderizar tabela resumo
        function renderSummaryTable(filterType = 'all') {
            const container = document.getElementById('summaryTableBody');
            container.innerHTML = '';
            
            let filteredUnits = unitsData;
            if (filterType !== 'all') {
                filteredUnits = unitsData.filter(unit => unit.type === filterType);
            }
            
            const sortedUnits = [...filteredUnits].sort((a, b) => {
                const aCritical = Object.values(a.products).filter(p => p.status === "danger").length;
                const bCritical = Object.values(b.products).filter(p => p.status === "danger").length;
                return bCritical - aCritical;
            }).slice(0, 10);
            
            sortedUnits.forEach(unit => {
                const criticalCount = Object.values(unit.products).filter(p => p.status === "danger").length;
                const attentionCount = Object.values(unit.products).filter(p => p.status === "warning").length;
                
                let status = "ok";
                if (criticalCount > 5) status = "danger";
                else if (criticalCount > 0 || attentionCount > 10) status = "warning";
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${unit.name}</td>
                    <td><span class="unit-type type-${unit.type.toLowerCase()}">${unit.type}</span></td>
                    <td>${criticalCount}</td>
                    <td>${attentionCount}</td>
                    <td>${unit.suggestions}</td>
                    <td><span class="status ${status}">${
                        status === 'ok' ? 'Normal' : 
                        status === 'warning' ? 'Aten√ß√£o' : 'Cr√≠tico'
                    }</span></td>
                    <td>${unit.lastUpdate}</td>
                `;
                
                container.appendChild(row);
            });
        }

        // Renderizar dados de efici√™ncia
        function renderEfficiencyData() {
            // Calcular efici√™ncia para cada unidade
            unitsData.forEach(unit => {
                let efficiencyScore = 0;
                let productsAnalyzed = 0;
                
                Object.values(unit.products).forEach(product => {
                    if (product.min > 0) {
                        const efficiency = Math.min(100, (product.current / product.min) * 100);
                        efficiencyScore += efficiency;
                        productsAnalyzed++;
                    }
                });
                
                unit.efficiency = productsAnalyzed > 0 ? efficiencyScore / productsAnalyzed : 0;
            });
            
            // Atualizar estat√≠sticas de efici√™ncia
            const efficientUnits = unitsData.filter(u => u.efficiency >= 90).length;
            const attentionUnits = unitsData.filter(u => u.efficiency >= 70 && u.efficiency < 90).length;
            const criticalUnits = unitsData.filter(u => u.efficiency < 70).length;
            
            document.getElementById('efficientUnits').textContent = efficientUnits;
            document.getElementById('attentionUnits').textContent = attentionUnits;
            document.getElementById('criticalUnits').textContent = criticalUnits;
            
            // Renderizar tabela de efici√™ncia
            const container = document.getElementById('efficiencyTableBody');
            container.innerHTML = '';
            
            const sortedByEfficiency = [...unitsData].sort((a, b) => b.efficiency - a.efficiency);
            
            sortedByEfficiency.forEach((unit, index) => {
                let efficiencyClass = 'efficiency-high';
                if (unit.efficiency < 90) efficiencyClass = 'efficiency-medium';
                if (unit.efficiency < 70) efficiencyClass = 'efficiency-low';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${unit.name}</td>
                    <td><span class="unit-type type-${unit.type.toLowerCase()}">${unit.type}</span></td>
                    <td>${unit.efficiency.toFixed(1)}%</td>
                    <td><span class="efficiency-badge ${efficiencyClass}">${
                        unit.efficiency >= 90 ? 'Alta' : 
                        unit.efficiency >= 70 ? 'M√©dia' : 'Baixa'
                    }</span></td>
                    <td>${Object.keys(unit.products).length}</td>
                `;
                
                container.appendChild(row);
            });
            
            // Renderizar gr√°ficos de efici√™ncia
            renderEfficiencyCharts();
        }

        // Renderizar gr√°ficos de efici√™ncia
        function renderEfficiencyCharts() {
            // Gr√°fico de distribui√ß√£o da efici√™ncia
            const efficiencyCtx = document.getElementById('efficiencyDistributionChart').getContext('2d');
            
            const efficiencyRanges = {
                '‚â• 90%': unitsData.filter(u => u.efficiency >= 90).length,
                '70-89%': unitsData.filter(u => u.efficiency >= 70 && u.efficiency < 90).length,
                '< 70%': unitsData.filter(u => u.efficiency < 70).length
            };
            
            charts.efficiencyDistributionChart = new Chart(efficiencyCtx, {
                type: 'pie',
                data: {
                    labels: Object.keys(efficiencyRanges),
                    datasets: [{
                        data: Object.values(efficiencyRanges),
                        backgroundColor: ['#28a745', '#ffc107', '#dc3545']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
            
            // Gr√°fico das 10 unidades mais eficientes
            const topEfficiencyCtx = document.getElementById('topEfficiencyChart').getContext('2d');
            const topEfficientUnits = [...unitsData].sort((a, b) => b.efficiency - a.efficiency).slice(0, 10);
            
            charts.topEfficiencyChart = new Chart(topEfficiencyCtx, {
                type: 'bar',
                data: {
                    labels: topEfficientUnits.map(u => u.name.substring(0, 15) + '...'),
                    datasets: [{
                        label: 'Efici√™ncia (%)',
                        data: topEfficientUnits.map(u => u.efficiency),
                        backgroundColor: '#28a745'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
            
            // Gr√°fico das 10 unidades menos eficientes
            const bottomEfficiencyCtx = document.getElementById('bottomEfficiencyChart').getContext('2d');
            const bottomEfficientUnits = [...unitsData].sort((a, b) => a.efficiency - b.efficiency).slice(0, 10);
            
            charts.bottomEfficiencyChart = new Chart(bottomEfficiencyCtx, {
                type: 'bar',
                data: {
                    labels: bottomEfficientUnits.map(u => u.name.substring(0, 15) + '...'),
                    datasets: [{
                        label: 'Efici√™ncia (%)',
                        data: bottomEfficientUnits.map(u => u.efficiency),
                        backgroundColor: '#dc3545'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
            
            // Gr√°fico de efici√™ncia por tipo de unidade
            const efficiencyByTypeCtx = document.getElementById('efficiencyByTypeChart').getContext('2d');
            
            const typeEfficiency = {
                'UBS': unitsData.filter(u => u.type === 'UBS').reduce((sum, u) => sum + u.efficiency, 0) / unitsData.filter(u => u.type === 'UBS').length,
                'CAIS': unitsData.filter(u => u.type === 'CAIS').reduce((sum, u) => sum + u.efficiency, 0) / unitsData.filter(u => u.type === 'CAIS').length,
                'DEMAIS': unitsData.filter(u => u.type === 'DEMAIS').reduce((sum, u) => sum + u.efficiency, 0) / unitsData.filter(u => u.type === 'DEMAIS').length
            };
            
            charts.efficiencyByTypeChart = new Chart(efficiencyByTypeCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(typeEfficiency),
                    datasets: [{
                        label: 'Efici√™ncia M√©dia (%)',
                        data: Object.values(typeEfficiency).map(v => v.toFixed(1)),
                        backgroundColor: ['#1a5276', '#2e86c1', '#85c1e9']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        // Renderizar sugest√µes com detalhes dos respondentes
        function renderSuggestions() {
            const suggestionsContainer = document.getElementById('suggestionsList');
            suggestionsContainer.innerHTML = '';
            
            suggestionsData.forEach(suggestion => {
                const respondent = respondents.find(r => r.id === suggestion.respondentId);
                
                const suggestionElement = document.createElement('div');
                suggestionElement.className = 'suggestion-item';
                suggestionElement.innerHTML = `
                    <div class="suggestion-header">
                        <div>
                            <strong>${suggestion.unit}</strong>
                            <div class="suggestion-date">${suggestion.date}</div>
                        </div>
                        <div class="product-name">${suggestion.product}</div>
                    </div>
                    <p>${suggestion.suggestion}</p>
                    <div class="respondent-info">
                        <div class="respondent-avatar">${respondent.avatar}</div>
                        <div class="respondent-details">
                            <div class="respondent-name">${respondent.name}</div>
                            <div class="respondent-role">${respondent.role}</div>
                        </div>
                    </div>
                `;
                
                suggestionElement.addEventListener('click', () => showRespondentDetails(respondent));
                suggestionsContainer.appendChild(suggestionElement);
            });
            
            // Renderizar problemas com fornecedor
            const supplierIssuesContainer = document.getElementById('supplierIssuesList');
            supplierIssuesContainer.innerHTML = '';
            
            const supplierIssues = suggestionsData.filter(s => 
                s.suggestion.toLowerCase().includes('fornecedor') || 
                s.suggestion.toLowerCase().includes('entrega') ||
                s.suggestion.toLowerCase().includes('pedido')
            );
            
            if (supplierIssues.length === 0) {
                supplierIssuesContainer.innerHTML = '<p>Nenhum problema espec√≠fico com fornecedor identificado nas sugest√µes.</p>';
            } else {
                supplierIssues.forEach(issue => {
                    const respondent = respondents.find(r => r.id === issue.respondentId);
                    
                    const issueElement = document.createElement('div');
                    issueElement.className = 'issue-item';
                    issueElement.innerHTML = `
                        <h4>${issue.unit} - ${issue.product}</h4>
                        <p>${issue.suggestion}</p>
                        <div style="display: flex; justify-content: space-between; margin-top: 0.5rem;">
                            <span class="respondent-name">${respondent.name}</span>
                            <span class="suggestion-date">${issue.date}</span>
                        </div>
                    `;
                    
                    supplierIssuesContainer.appendChild(issueElement);
                });
            }
        }

        // Mostrar detalhes do respondente
        function showRespondentDetails(respondent) {
            const container = document.getElementById('respondentDetails');
            
            // Encontrar sugest√µes deste respondente
            const respondentSuggestions = suggestionsData.filter(s => s.respondentId === respondent.id);
            
            container.innerHTML = `
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                    <div class="respondent-avatar" style="width: 60px; height: 60px; font-size: 1.5rem;">${respondent.avatar}</div>
                    <div>
                        <h3>${respondent.name}</h3>
                        <p class="respondent-role">${respondent.role}</p>
                        <p class="respondent-role">${respondent.unit}</p>
                    </div>
                </div>
                
                <div style="margin-bottom: 1.5rem;">
                    <h4>Informa√ß√µes de Contato</h4>
                    <p><i class="fas fa-envelope"></i> ${respondent.name.toLowerCase().replace(' ', '.')}@sms.example.gov.br</p>
                    <p><i class="fas fa-phone"></i> (54) 3220-${Math.floor(1000 + Math.random() * 9000)}</p>
                </div>
                
                <div>
                    <h4>Estat√≠sticas</h4>
                    <p><strong>${respondentSuggestions.length}</strong> sugest√µes enviadas</p>
                    <p><strong>${new Date().getFullYear() - 2020}</strong> anos na unidade</p>
                </div>
                
                <div style="margin-top: 1.5rem;">
                    <h4>√öltimas Sugest√µes</h4>
                    <ul style="padding-left: 1.5rem; margin-top: 0.5rem;">
                        ${respondentSuggestions.slice(0, 3).map(s => 
                            `<li style="margin-bottom: 0.5rem;">${s.product} - ${s.date}</li>`
                        ).join('')}
                    </ul>
                </div>
            `;
        }

        // Inicializar gr√°ficos de an√°lise IA
        function initializeAnalysisCharts() {
            // Gr√°fico de efici√™ncia por tipo
            const efficiencyCtx = document.getElementById('efficiencyChart').getContext('2d');
            
            const typeEfficiency = {
                'UBS': Math.floor(Math.random() * 30) + 65,
                'CAIS': Math.floor(Math.random() * 25) + 70,
                'DEMAIS': Math.floor(Math.random() * 35) + 60
            };
            
            charts.efficiencyChart = new Chart(efficiencyCtx, {
                type: 'bar',
                data: {
                    labels: ['UBS', 'CAIS', 'Demais'],
                    datasets: [{
                        label: 'Efici√™ncia de Estoque (%)',
                        data: [typeEfficiency.UBS, typeEfficiency.CAIS, typeEfficiency.DEMAIS],
                        backgroundColor: ['#28a745', '#17a2b8', '#6c757d']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });

            // Gr√°fico de correla√ß√£o
            const correlationCtx = document.getElementById('correlationChart').getContext('2d');
            charts.correlationChart = new Chart(correlationCtx, {
                type: 'radar',
                data: {
                    labels: ['√ÅGUA SANIT√ÅRIA', '√ÅLCOOL 70%', 'DESINFETANTE', 'DETERGENTE', 'SACOS DE LIXO'],
                    datasets: [
                        {
                            label: 'UBS',
                            data: [65, 59, 80, 71, 56],
                            fill: true,
                            backgroundColor: 'rgba(40, 167, 69, 0.2)',
                            borderColor: 'rgb(40, 167, 69)',
                            pointBackgroundColor: 'rgb(40, 167, 69)'
                        },
                        {
                            label: 'CAIS',
                            data: [48, 78, 62, 69, 74],
                            fill: true,
                            backgroundColor: 'rgba(23, 162, 184, 0.2)',
                            borderColor: 'rgb(23, 162, 184)',
                            pointBackgroundColor: 'rgb(23, 162, 184)'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    elements: {
                        line: {
                            borderWidth: 3
                        }
                    }
                }
            });
        }

        // Fun√ß√µes de exporta√ß√£o para PDF
        function exportOverviewToPDF() {
            toggleLoading(true);
            
            setTimeout(() => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                doc.text("Relat√≥rio de Vis√£o Geral - Materiais de Limpeza", 20, 20);
                doc.text(`Data de gera√ß√£o: ${new Date().toLocaleDateString('pt-BR')}`, 20, 30);
                doc.text(`Total de unidades: ${unitsData.length}`, 20, 40);
                doc.text(`Total de produtos: ${productsList.length}`, 20, 50);
                
                let yPosition = 70;
                doc.text("Top 5 Unidades com Mais Solicita√ß√µes:", 20, yPosition);
                yPosition += 10;
                
                const topUnits = [...unitsData].sort((a, b) => {
                    const aCritical = Object.values(a.products).filter(p => p.status === "danger").length;
                    const bCritical = Object.values(b.products).filter(p => p.status === "danger").length;
                    return bCritical - aCritical;
                }).slice(0, 5);
                
                topUnits.forEach((unit, index) => {
                    const criticalCount = Object.values(unit.products).filter(p => p.status === "danger").length;
                    doc.text(`${index + 1}. ${unit.name} - ${criticalCount} produtos cr√≠ticos`, 25, yPosition);
                    yPosition += 7;
                });
                
                doc.save("relatorio_visao_geral.pdf");
                toggleLoading(false);
                alert('Relat√≥rio de Vis√£o Geral exportado com sucesso!');
            }, 1500);
        }

        function exportCriticalToPDF() {
            toggleLoading(true);
            
            setTimeout(() => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                doc.text("Relat√≥rio de Situa√ß√£o Cr√≠tica - Materiais de Limpeza", 20, 20);
                doc.text(`Data de gera√ß√£o: ${new Date().toLocaleDateString('pt-BR')}`, 20, 30);
                
                const criticalUnits = unitsData.filter(unit => {
                    const criticalCount = Object.values(unit.products).filter(p => p.status === "danger").length;
                    return criticalCount > 5;
                });
                
                doc.text(`Unidades em situa√ß√£o cr√≠tica: ${criticalUnits.length}`, 20, 45);
                
                let yPosition = 60;
                criticalUnits.forEach((unit, index) => {
                    if (yPosition > 270) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    const criticalCount = Object.values(unit.products).filter(p => p.status === "danger").length;
                    doc.text(`${index + 1}. ${unit.name} (${unit.type})`, 20, yPosition);
                    doc.text(`   Produtos cr√≠ticos: ${criticalCount}`, 25, yPosition + 7);
                    yPosition += 15;
                });
                
                doc.save("relatorio_situacao_critica.pdf");
                toggleLoading(false);
                alert('Relat√≥rio de Situa√ß√£o Cr√≠tica exportado com sucesso!');
            }, 1500);
        }

        function exportSupplierIssuesToPDF() {
            toggleLoading(true);
            
            setTimeout(() => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                doc.text("Relat√≥rio de Problemas com Fornecedor", 20, 20);
                doc.text(`Data de gera√ß√£o: ${new Date().toLocaleDateString('pt-BR')}`, 20, 30);
                
                const supplierIssues = suggestionsData.filter(s => 
                    s.suggestion.toLowerCase().includes('fornecedor') || 
                    s.suggestion.toLowerCase().includes('entrega') ||
                    s.suggestion.toLowerCase().includes('pedido')
                );
                
                doc.text(`Problemas identificados: ${supplierIssues.length}`, 20, 45);
                
                let yPosition = 60;
                supplierIssues.forEach((issue, index) => {
                    if (yPosition > 270) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    const respondent = respondents.find(r => r.id === issue.respondentId);
                    
                    doc.text(`${index + 1}. ${issue.unit} - ${issue.product}`, 20, yPosition);
                    doc.text(`   Data: ${issue.date}`, 25, yPosition + 7);
                    doc.text(`   Respons√°vel: ${respondent.name}`, 25, yPosition + 14);
                    doc.text(`   Descri√ß√£o: ${issue.suggestion.substring(0, 80)}...`, 25, yPosition + 21);
                    
                    yPosition += 35;
                });
                
                doc.save("relatorio_problemas_fornecedor.pdf");
                toggleLoading(false);
                alert('Relat√≥rio de Problemas com Fornecedor exportado com sucesso!');
            }, 1500);
        }

        // Fun√ß√£o de exporta√ß√£o de detalhes do produto
        function exportProductDetailToPDF() {
            if (!currentSelectedProduct) {
                alert('Selecione um produto primeiro!');
                return;
            }
            
            toggleLoading(true);
            
            setTimeout(() => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                doc.text(`Relat√≥rio Detalhado - ${currentSelectedProduct}`, 20, 20);
                doc.text(`Data de gera√ß√£o: ${new Date().toLocaleDateString('pt-BR')}`, 20, 30);
                
                // Calcular estat√≠sticas
                let totalStock = 0;
                let totalMin = 0;
                let lowStockCount = 0;
                let criticalStockCount = 0;
                
                unitsData.forEach(unit => {
                    if (unit.products[currentSelectedProduct]) {
                        const product = unit.products[currentSelectedProduct];
                        totalStock += product.current;
                        totalMin += product.min;
                        
                        if (product.status === "warning") lowStockCount++;
                        if (product.status === "danger") criticalStockCount++;
                    }
                });
                
                doc.text(`Total em estoque: ${totalStock}`, 20, 45);
                doc.text(`M√≠nimo sugerido: ${totalMin}`, 20, 55);
                doc.text(`Unidades com baixo estoque: ${lowStockCount}`, 20, 65);
                doc.text(`Unidades cr√≠ticas: ${criticalStockCount}`, 20, 75);
                
                // Adicionar lista de unidades cr√≠ticas
                let yPosition = 90;
                doc.text("Unidades com situa√ß√£o cr√≠tica:", 20, yPosition);
                yPosition += 10;
                
                const criticalUnits = unitsData.filter(unit => 
                    unit.products[currentSelectedProduct] && 
                    unit.products[currentSelectedProduct].status === "danger"
                ).slice(0, 10);
                
                criticalUnits.forEach((unit, index) => {
                    if (yPosition > 270) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    const product = unit.products[currentSelectedProduct];
                    doc.text(`${index + 1}. ${unit.name} - ${product.current}/${product.min}`, 25, yPosition);
                    yPosition += 7;
                });
                
                doc.save(`relatorio_${currentSelectedProduct.replace(/[^a-zA-Z0-9]/g, '_')}.pdf`);
                toggleLoading(false);
                alert(`Relat√≥rio de ${currentSelectedProduct} exportado com sucesso!`);
            }, 1500);
        }

        // Configurar event listeners
        function setupEventListeners() {
            // Alternar entre abas
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.tab).classList.add('active');
                    
                    // Inicializar gr√°ficos espec√≠ficos da aba se necess√°rio
                    if (tab.dataset.tab === 'analysis' && !charts.efficiencyChart) {
                        initializeAnalysisCharts();
                    }
                });
            });
            
            // Bot√£o de atualizar dados
            document.getElementById('refreshData').addEventListener('click', () => {
                toggleLoading(true);
                
                setTimeout(() => {
                    // Simular atualiza√ß√£o de dados
                    unitsData.forEach(unit => {
                        Object.values(unit.products).forEach(product => {
                            const variation = Math.random() > 0.7 ? (Math.random() > 0.5 ? 1 : -1) : 0;
                            product.current = Math.max(0, product.current + variation);
                            
                            // Atualizar status
                            if (product.current === 0) {
                                product.status = "danger";
                            } else if (product.current < product.min) {
                                product.status = "warning";
                            } else {
                                product.status = "ok";
                            }
                        });
                        
                        unit.lastUpdate = new Date().toLocaleDateString('pt-BR');
                    });
                    
                    // Recarregar todos os dados e gr√°ficos
                    updateStats();
                    renderCharts(currentFilter);
                    renderUnitsList();
                    renderProductsTable();
                    renderSummaryTable(currentFilter);
                    renderEfficiencyData();
                    renderSuggestions();
                    
                    toggleLoading(false);
                    alert('Dados atualizados com sucesso!');
                }, 1500);
            });
            
            // Bot√£o de atualizar produtos
            document.getElementById('refreshProducts').addEventListener('click', () => {
                toggleLoading(true);
                
                setTimeout(() => {
                    // Simular atualiza√ß√£o de dados
                    unitsData.forEach(unit => {
                        Object.values(unit.products).forEach(product => {
                            const variation = Math.random() > 0.7 ? (Math.random() > 0.5 ? 1 : -1) : 0;
                            product.current = Math.max(0, product.current + variation);
                            
                            // Atualizar status
                            if (product.current === 0) {
                                product.status = "danger";
                            } else if (product.current < product.min) {
                                product.status = "warning";
                            } else {
                                product.status = "ok";
                            }
                        });
                    });
                    
                    renderProductsTable();
                    
                    // Se h√° um produto selecionado, atualizar seus detalhes tamb√©m
                    if (currentSelectedProduct) {
                        showProductDetails(currentSelectedProduct);
                    }
                    
                    toggleLoading(false);
                    alert('Dados atualizados com sucesso!');
                }, 1500);
            });
            
            // Filtro por tipo de unidade
            document.getElementById('filterType').addEventListener('change', (e) => {
                currentFilter = e.target.value;
                renderCharts(currentFilter);
                renderSummaryTable(currentFilter);
            });
            
            // Filtro por produto
            document.getElementById('filterProduct').addEventListener('change', (e) => {
                if (e.target.value !== 'all') {
                    showProductDetails(e.target.value);
                }
            });
            
            // Configurar bot√µes de exporta√ß√£o
            document.getElementById('exportOverview').addEventListener('click', exportOverviewToPDF);
            document.getElementById('exportCritical').addEventListener('click', exportCriticalToPDF);
            document.getElementById('exportSupplierIssues').addEventListener('click', exportSupplierIssuesToPDF);
            document.getElementById('exportProductDetail').addEventListener('click', exportProductDetailToPDF);
        }

        // Inicializar o dashboard quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', initDashboard);
    </script>
</body>
</html>
