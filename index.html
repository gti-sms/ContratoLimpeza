<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Completo - Materiais de Limpeza SMS</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a5276;
            --primary-dark: #13405c;
            --primary-light: #2e86c1;
            --secondary: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --light: #f8f9fa;
            --dark: #343a40;
            --gray: #6c757d;
            --light-gray: #e9ecef;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            min-height: 100vh;
            color: var(--dark);
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            padding: 1.5rem 2rem;
            border-radius: 10px 10px 0 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .logo {
            font-size: 2.5rem;
        }
        
        .header-text h1 {
            font-size: 1.8rem;
            margin-bottom: 0.25rem;
        }
        
        .dashboard {
            background: white;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .tabs {
            display: flex;
            background: var(--light);
            border-bottom: 1px solid var(--light-gray);
        }
        
        .tab {
            padding: 1rem 1.5rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
            background: white;
        }
        
        .tab-content {
            display: none;
            padding: 2rem;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: var(--light);
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border-left: 4px solid var(--primary);
        }
        
        .stat-card h3 {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .chart-container {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            height: 300px;
        }
        
        .table-container {
            margin-top: 2rem;
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--light-gray);
        }
        
        th {
            background: var(--primary);
            color: white;
            position: sticky;
            top: 0;
        }
        
        tr:hover {
            background: rgba(26, 82, 118, 0.05);
        }
        
        .status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .ok { background: #d4edda; color: #155724; }
        .warning { background: #fff3cd; color: #856404; }
        .danger { background: #f8d7da; color: #721c24; }
        
        .controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        select, button {
            padding: 0.7rem 1rem;
            border: 1px solid var(--light-gray);
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        select {
            background: white;
            min-width: 200px;
        }
        
        button {
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: background 0.3s ease;
        }
        
        button:hover {
            background: var(--primary-dark);
        }
        
        .unit-details {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2rem;
        }
        
        .units-list {
            background: var(--light);
            border-radius: 8px;
            padding: 1.5rem;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .unit-item {
            padding: 1rem;
            margin-bottom: 0.5rem;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid var(--primary);
        }
        
        .unit-item:hover {
            background: #e9ecef;
        }
        
        .unit-item.active {
            background: var(--primary-light);
            color: white;
        }
        
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .product-card {
            background: white;
            border: 1px solid var(--light-gray);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .product-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .product-name {
            font-weight: bold;
            color: var(--primary);
        }
        
        .product-data {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .data-item {
            margin-bottom: 0.5rem;
        }
        
        .data-label {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        .data-value {
            font-weight: bold;
        }
        
        .suggestions {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--light-gray);
        }
        
        .suggestion-item {
            background: #e7f3ff;
            padding: 0.5rem;
            border-radius: 4px;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        
        .ai-insights {
            background: #f0f8ff;
            border-left: 4px solid var(--primary);
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 2rem;
        }
        
        .insight-item {
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #d1e7ff;
        }
        
        .insight-item:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }
        
        footer {
            text-align: center;
            padding: 2rem;
            color: var(--gray);
            margin-top: 2rem;
        }
        
        .unit-type {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 0.5rem;
        }
        
        .type-ubs { background: #d4edda; color: #155724; }
        .type-cais { background: #cce7ff; color: #004085; }
        .type-demais { background: #f8d7da; color: #721c24; }
        
        /* Novos estilos para efici√™ncia de estoque */
        .efficiency-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .efficiency-stat-card {
            background: var(--light);
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .efficiency-stat-card.efficient {
            border-left: 4px solid var(--secondary);
        }
        
        .efficiency-stat-card.attention {
            border-left: 4px solid var(--warning);
        }
        
        .efficiency-stat-card.critical {
            border-left: 4px solid var(--danger);
        }
        
        .efficiency-stat-card h3 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .efficiency-stat-card.efficient h3 {
            color: var(--secondary);
        }
        
        .efficiency-stat-card.attention h3 {
            color: var(--warning);
        }
        
        .efficiency-stat-card.critical h3 {
            color: var(--danger);
        }
        
        .efficiency-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .efficiency-high {
            background: #d4edda;
            color: #155724;
        }
        
        .efficiency-medium {
            background: #fff3cd;
            color: #856404;
        }
        
        .efficiency-low {
            background: #f8d7da;
            color: #721c24;
        }
        
        .gauge-container {
            position: relative;
            width: 100%;
            height: 200px;
            margin: 0 auto;
        }
        
        .gauge-chart {
            width: 100%;
            height: 100%;
        }
        
        .ranking-table th:nth-child(3),
        .ranking-table td:nth-child(3) {
            text-align: center;
        }
        
        @media (max-width: 1200px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .stats, .efficiency-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .unit-details {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .stats, .efficiency-stats {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1;
                min-width: 120px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo-container">
                    <i class="fas fa-hand-holding-medical logo"></i>
                    <div class="header-text">
                        <h1>Painel Completo - Materiais de Limpeza</h1>
                        <p>Secretaria Municipal de Sa√∫de - Vis√£o Consolidada de Todas as Unidades</p>
                    </div>
                </div>
                <div class="header-stats">
                    <div style="text-align: center;">
                        <div style="font-size: 1.5rem; font-weight: bold;" id="totalUnits">55</div>
                        <div style="font-size: 0.8rem;">Unidades Monitoradas</div>
                    </div>
                </div>
            </div>
        </header>
        
        <div class="dashboard">
            <div class="tabs">
                <div class="tab active" data-tab="overview">Vis√£o Geral</div>
                <div class="tab" data-tab="efficiency">Efici√™ncia de Estoque</div>
                <div class="tab" data-tab="units">Unidades</div>
                <div class="tab" data-tab="products">Produtos</div>
                <div class="tab" data-tab="analysis">An√°lise IA</div>
            </div>
            
            <div class="tab-content active" id="overview">
                <div class="controls">
                    <select id="filterType">
                        <option value="all">Todos os Tipos</option>
                        <option value="UBS">UBS</option>
                        <option value="CAIS">CAIS</option>
                        <option value="DEMAIS">Demais</option>
                    </select>
                    <button id="refreshData">
                        <i class="fas fa-sync-alt"></i> Atualizar Dados em Tempo Real
                    </button>
                </div>
                
                <div class="stats">
                    <div class="stat-card">
                        <h3 id="totalUnitsCount">55</h3>
                        <p>Unidades de Sa√∫de</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalProductsCount">23</h3>
                        <p>Tipos de Produtos</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="criticalAlerts">18</h3>
                        <p>Alertas Cr√≠ticos</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="suggestionsCount">42</h3>
                        <p>Sugest√µes Recebidas</p>
                    </div>
                </div>
                
                <div class="charts-grid">
                    <div class="chart-container">
                        <h3>Status do Estoque por Unidade (Top 10)</h3>
                        <canvas id="statusChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Produtos Mais Faltantes</h3>
                        <canvas id="productsChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Distribui√ß√£o por Tipo de Unidade</h3>
                        <canvas id="typeChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Evolu√ß√£o de Alertas (√öltimos 6 Meses)</h3>
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>
                
                <div class="table-container">
                    <h3>Top 10 Unidades com Mais Solicita√ß√µes</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Unidade</th>
                                <th>Tipo</th>
                                <th>Produtos Cr√≠ticos</th>
                                <th>Produtos em Aten√ß√£o</th>
                                <th>Sugest√µes</th>
                                <th>Status Geral</th>
                                <th>√öltima Atualiza√ß√£o</th>
                            </tr>
                        </thead>
                        <tbody id="summaryTableBody">
                            <!-- Dados preenchidos via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- NOVA ABA: Efici√™ncia de Estoque -->
            <div class="tab-content" id="efficiency">
                <h2><i class="fas fa-chart-line"></i> Efici√™ncia de Estoque por Unidade</h2>
                <p class="data-label" style="margin-bottom: 1.5rem;">An√°lise da adequa√ß√£o entre materiais disponibilizados e necessidades m√≠nimas sugeridas</p>
                
                <div class="efficiency-stats">
                    <div class="efficiency-stat-card efficient">
                        <h3 id="efficientUnits">0</h3>
                        <p>Unidades Eficientes</p>
                        <small>Efici√™ncia ‚â• 90%</small>
                    </div>
                    <div class="efficiency-stat-card attention">
                        <h3 id="attentionUnits">0</h3>
                        <p>Unidades em Aten√ß√£o</p>
                        <small>Efici√™ncia 70-89%</small>
                    </div>
                    <div class="efficiency-stat-card critical">
                        <h3 id="criticalUnits">0</h3>
                        <p>Unidades Cr√≠ticas</p>
                        <small>Efici√™ncia < 70%</small>
                    </div>
                </div>
                
                <div class="charts-grid">
                    <div class="chart-container">
                        <h3>Distribui√ß√£o da Efici√™ncia</h3>
                        <canvas id="efficiencyDistributionChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Top 10 Unidades Mais Eficientes</h3>
                        <canvas id="topEfficiencyChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Top 10 Unidades Menos Eficientes</h3>
                        <canvas id="bottomEfficiencyChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Efici√™ncia M√©dia por Tipo de Unidade</h3>
                        <canvas id="efficiencyByTypeChart"></canvas>
                    </div>
                </div>
                
                <div class="table-container">
                    <h3>Ranking de Efici√™ncia por Unidade</h3>
                    <table class="ranking-table">
                        <thead>
                            <tr>
                                <th>Posi√ß√£o</th>
                                <th>Unidade</th>
                                <th>Tipo</th>
                                <th>Efici√™ncia</th>
                                <th>Status</th>
                                <th>Produtos Analisados</th>
                            </tr>
                        </thead>
                        <tbody id="efficiencyTableBody">
                            <!-- Dados preenchidos via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="tab-content" id="units">
                <div class="unit-details">
                    <div class="units-list">
                        <h3>Lista de Unidades</h3>
                        <div id="unitsListContainer">
                            <!-- Lista de unidades preenchida via JavaScript -->
                        </div>
                    </div>
                    
                    <div class="unit-details-content">
                        <h3 id="selectedUnitName">Selecione uma unidade para ver detalhes</h3>
                        <div id="unitProductsGrid" class="product-grid">
                            <!-- Produtos da unidade selecionada -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="products">
                <div class="controls">
                    <select id="filterProduct">
                        <option value="all">Todos os Produtos</option>
                        <!-- Op√ß√µes preenchidas via JavaScript -->
                    </select>
                </div>
                
                <div class="table-container">
                    <h3>Detalhamento por Produto</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Produto</th>
                                <th>Total Dispon√≠vel</th>
                                <th>Total M√≠nimo Sugerido</th>
                                <th>Unidades com Estoque Baixo</th>
                                <th>Unidades com Estoque Cr√≠tico</th>
                                <th>Status Geral</th>
                            </tr>
                        </thead>
                        <tbody id="productsTableBody">
                            <!-- Dados preenchidos via JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <div class="chart-container" style="height: 400px; margin-top: 2rem;">
                    <h3>Distribui√ß√£o do Produto por Unidade</h3>
                    <canvas id="productDistributionChart"></canvas>
                </div>
            </div>
            
            <div class="tab-content" id="analysis">
                <h2>An√°lises e Insights por IA</h2>
                
                <div class="ai-insights">
                    <h3><i class="fas fa-robot"></i> Insights Inteligentes</h3>
                    
                    <div class="insight-item">
                        <h4>üìä Padr√µes de Consumo Identificados</h4>
                        <p>As unidades do tipo CAIS apresentam 25% mais consumo de √ÅLCOOL 70% em compara√ß√£o com UBS. Recomenda-se ajuste na distribui√ß√£o.</p>
                    </div>
                    
                    <div class="insight-item">
                        <h4>üö® Alertas Priorit√°rios</h4>
                        <p>5 unidades est√£o com estoque cr√≠tico de m√∫ltiplos produtos simultaneamente: UBS Petr√≥polis, UBS Independente, Ambulat√≥rio Bela Vista, Cais H√≠pica e UBS Jardim Am√©rica.</p>
                    </div>
                    
                    <div class="insight-item">
                        <h4>üí° Sugest√µes Consolidadas</h4>
                        <p>As sugest√µes mais frequentes s√£o: "Escova para limpeza dos panos" (12 unidades), "Luvas de borracha" (8 unidades) e "Baldes adicionais" (6 unidades).</p>
                    </div>
                    
                    <div class="insight-item">
                        <h4>üìà Tend√™ncias e Previs√µes</h4>
                        <p>Com base no hist√≥rico, h√° tend√™ncia de aumento de 15% no consumo de DESINFETANTE para o pr√≥ximo trimestre. Recomenda-se planejamento antecipado.</p>
                    </div>
                    
                    <div class="insight-item">
                        <h4>üí∞ Otimiza√ß√£o de Recursos</h4>
                        <p>Identificado potencial de economia de 18% atrav√©s da padroniza√ß√£o de pedidos entre unidades do mesmo tipo.</p>
                    </div>
                </div>
                
                <div class="charts-grid" style="margin-top: 2rem;">
                    <div class="chart-container">
                        <h3>Efici√™ncia de Estoque por Tipo</h3>
                        <canvas id="efficiencyChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Correla√ß√£o entre Produtos</h3>
                        <canvas id="correlationChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Secretaria Municipal de Sa√∫de &copy; 2025 - Sistema de Controle de Materiais de Limpeza</p>
            <p>Painel de Monitoramento Completo - Dados em Tempo Real | <a href="#" style="color: var(--primary);">GitHub Repository</a></p>
        </footer>
    </div>

    <script>
        // Dados completos de exemplo baseados na sua estrutura
        const productsList = [
            "√ÅGUA SANIT√ÅRIA 5L", "√ÅLCOOL IL 70%", "AROMATIZADOR AR AGRAD√ÅVEL 400ML", 
            "DESINFETANTE 5L", "DETERGENTE 500ML", "DETERGENTE 5L COLORADO",
            "ESPONJA DUPLA FACE 70X100", "FLANELA (30X40) BRANCA", "LUSTRA M√ìVEIS 200ML",
            "PANO DE CH√ÉO ALVEJADO 40X62", "PANO DE PRATO 45X75", "SAB√ÉO EM P√ì 1 KG",
            "SACO DE LIXO 100L 0,08 C/100", "SACO DE LIXO 20L 0,04 C/100", "SACO DE LIXO 60L 0,06 C/100",
            "SAP√ìLIO CREMOSO 250ML", "VASSOURA DE NYLON", "PASSADOR DE CERA",
            "RODO DE PL√ÅSTICO DUPLO 40CM", "P√Å DE LIXO PL√ÅSTICA CABO LONGO", 
            "ESCOVA SANIT√ÅRIA DE PL√ÅSTICO C/SUPORTE", "BALDE 08L PL√ÅSTICO", "CERA"
        ];

        // Gerar dados completos para todas as unidades
        const unitsData = [];
        const unitNames = [
            "Ambulat√≥rio Bela Vista", "Ambulat√≥rio Capinzal", "Ambulat√≥rio Especialidades", 
            "Ambulat√≥rio Pulador", "Ambulat√≥rio S√£o Valentin/S√£o Roque",
            "Cais Dr. Ant√¥nio Marinho Albuquerque ‚Äì Vila Lu√≠za", "Cais Dr. Cyrio Nacul ‚Äì Petr√≥polis",
            "Cais Dr. Erwin Crussius ‚Äì H√≠pica", "Cais Dr. Lu√≠s Augusto Hexsel ‚Äì Boqueir√£o",
            "Cais Dr. Lu√≠s Fragomeni ‚Äì S√£o Crist√≥v√£o", "Caps Ad", "Caps I", "Caps II",
            "Central de Vacinas", "Centro de Refer√™ncia de Sa√∫de da Mulher",
            "Centro de Refer√™ncia de Sa√∫de do Idoso", "Capne", "Coordenadoria de Vigil√¢ncia em Sa√∫de",
            "UBS 1¬∫ Centen√°rio", "UBS Adirbal Corralo", "UBS Adolfo Groth", "UBS Adriana Lirio ‚Äì Oper√°ria",
            "UBS Edu Villa de Azambuja (Caic)", "UBS Jaboticabal", "UBS Jer√¥nimo Coelho",
            "UBS Planaltina", "UBS Ricci", "UBS Santa Marta / UBS Don√°ria", "UBS S√£o Crist√≥v√£o",
            "UBS S√£o Luiz Gonzaga", "Farm√°cia Central", "SAMU", "Secretaria Municipal De Sa√∫de",
            "Servi√ßo de Atendimento Especializado ‚Äì SAE", "UBS Annes", "UBS Bom Recreio",
            "UBS Entre Rios", "UBS Independente", "UBS Ivo Ferreira", "UBS Nossa Senhora Aparecida",
            "UBS Parque Farroupilha", "UBS Petr√≥polis", "UBS Santa Rita", 
            "UBS Santo Ant√¥nio Da Pedreira", "UBS Vila Nova", "Ambulat√≥rio Sede Independ√™ncia",
            "UBS H√≠pica", "UBS Mattos", "UBS Nene Graef", "UBS S√£o Jos√©", "UBS Valinhos",
            "UBS Zachia", "UBS Jardim Am√©rica", "UBS Menino Deus", "UBS Nonoai", "UBS Prisional"
        ];

        // Classificar unidades por tipo
        function getUnitType(unitName) {
            if (unitName.includes('Cais') || unitName.includes('CAIS')) {
                return 'CAIS';
            } else if (unitName.includes('UBS') || unitName.includes('ESF')) {
                return 'UBS';
            } else {
                return 'DEMAIS';
            }
        }

        // Gerar dados realistas para cada unidade
        unitNames.forEach((name, index) => {
            const unitType = getUnitType(name);
            const products = [];
            
            productsList.forEach(productName => {
                // Gerar dados realistas para cada produto
                const minSuggested = Math.floor(Math.random() * 5) + 1;
                const currentStock = Math.floor(Math.random() * (minSuggested + 3));
                let status = "ok";
                
                if (currentStock === 0) {
                    status = "danger";
                } else if (currentStock < minSuggested) {
                    status = "warning";
                }
                
                // Algumas unidades ter√£o sugest√µes
                const hasSuggestion = Math.random() > 0.7;
                const suggestion = hasSuggestion ? 
                    ["Escova (para limpeza dos panos)", "Luvas de borracha", "Balde adicional", "Pano de ch√£o extra"][Math.floor(Math.random() * 4)] : "";
                
                const suggestedQty = hasSuggestion ? Math.floor(Math.random() * 3) + 1 : 0;
                
                products.push({
                    name: productName,
                    current: currentStock,
                    minSuggested: minSuggested,
                    status: status,
                    suggestion: suggestion,
                    suggestedQty: suggestedQty
                });
            });
            
            unitsData.push({
                id: index + 1,
                name: name,
                type: unitType,
                products: products,
                lastUpdate: `15/10/2025 - ${Math.floor(Math.random() * 24)}:${Math.floor(Math.random() * 60).toString().padStart(2, '0')}`
            });
        });

        // Elementos DOM
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const filterType = document.getElementById('filterType');
        const refreshData = document.getElementById('refreshData');
        const filterProduct = document.getElementById('filterProduct');
        const unitsListContainer = document.getElementById('unitsListContainer');
        const selectedUnitName = document.getElementById('selectedUnitName');
        const unitProductsGrid = document.getElementById('unitProductsGrid');
        const summaryTableBody = document.getElementById('summaryTableBody');
        const productsTableBody = document.getElementById('productsTableBody');
        const efficiencyTableBody = document.getElementById('efficiencyTableBody');
        const efficientUnits = document.getElementById('efficientUnits');
        const attentionUnits = document.getElementById('attentionUnits');
        const criticalUnits = document.getElementById('criticalUnits');
        
        // Vari√°veis para gr√°ficos
        let charts = {};

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            setupEventListeners();
            renderAllCharts();
            updateSummaryTable();
            renderUnitsList();
            renderProductsTable();
            populateProductFilter();
            calculateEfficiency();
        });

        // Inicializar dashboard
        function initializeDashboard() {
            updateCounters();
        }

        // Configurar event listeners
        function setupEventListeners() {
            // Tabs
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Remover classe active de todas as tabs e conte√∫dos
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    // Adicionar classe active √† tab e conte√∫do selecionados
                    this.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                    
                    // Renderizar gr√°ficos espec√≠ficos da tab se necess√°rio
                    if (tabId === 'products') {
                        renderProductDistributionChart();
                    } else if (tabId === 'analysis') {
                        if (!charts.efficiency) {
                            setTimeout(initializeAnalysisCharts, 100);
                        }
                    } else if (tabId === 'efficiency') {
                        calculateEfficiency();
                    }
                });
            });

            // Filtros
            filterType.addEventListener('change', updateDashboard);
            refreshData.addEventListener('click', refreshDataHandler);
            filterProduct.addEventListener('change', renderProductsTable);
        }

        // Calcular efici√™ncia de estoque
        function calculateEfficiency() {
            // Calcular efici√™ncia para cada unidade
            const efficiencyData = unitsData.map(unit => {
                let totalCurrent = 0;
                let totalMinSuggested = 0;
                let productsAnalyzed = 0;
                
                unit.products.forEach(product => {
                    if (product.minSuggested > 0) {
                        totalCurrent += product.current;
                        totalMinSuggested += product.minSuggested;
                        productsAnalyzed++;
                    }
                });
                
                const efficiency = totalMinSuggested > 0 ? (totalCurrent / totalMinSuggested) * 100 : 100;
                
                let efficiencyStatus = 'high';
                if (efficiency < 70) {
                    efficiencyStatus = 'low';
                } else if (efficiency < 90) {
                    efficiencyStatus = 'medium';
                }
                
                return {
                    unit: unit,
                    efficiency: Math.round(efficiency),
                    status: efficiencyStatus,
                    productsAnalyzed: productsAnalyzed
                };
            });
            
            // Ordenar por efici√™ncia
            efficiencyData.sort((a, b) => b.efficiency - a.efficiency);
            
            // Atualizar contadores de efici√™ncia
            updateEfficiencyCounters(efficiencyData);
            
            // Atualizar tabela de ranking
            updateEfficiencyTable(efficiencyData);
            
            // Renderizar gr√°ficos de efici√™ncia
            renderEfficiencyCharts(efficiencyData);
        }

        // Atualizar contadores de efici√™ncia
        function updateEfficiencyCounters(efficiencyData) {
            const efficientCount = efficiencyData.filter(item => item.status === 'high').length;
            const attentionCount = efficiencyData.filter(item => item.status === 'medium').length;
            const criticalCount = efficiencyData.filter(item => item.status === 'low').length;
            
            efficientUnits.textContent = efficientCount;
            attentionUnits.textContent = attentionCount;
            criticalUnits.textContent = criticalCount;
        }

        // Atualizar tabela de efici√™ncia
        function updateEfficiencyTable(efficiencyData) {
            efficiencyTableBody.innerHTML = '';
            
            efficiencyData.forEach((item, index) => {
                const position = index + 1;
                const unit = item.unit;
                const efficiency = item.efficiency;
                const status = item.status;
                const productsAnalyzed = item.productsAnalyzed;
                
                const statusClass = status === 'high' ? 'efficiency-high' : 
                                  status === 'medium' ? 'efficiency-medium' : 'efficiency-low';
                
                const statusText = status === 'high' ? 'Eficiente' : 
                                 status === 'medium' ? 'Aten√ß√£o' : 'Cr√≠tico';
                
                const typeClass = `type-${unit.type.toLowerCase()}`;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${position}</td>
                    <td>${unit.name}</td>
                    <td><span class="unit-type ${typeClass}">${unit.type}</span></td>
                    <td>${efficiency}%</td>
                    <td><span class="efficiency-badge ${statusClass}">${statusText}</span></td>
                    <td>${productsAnalyzed}</td>
                `;
                
                efficiencyTableBody.appendChild(row);
            });
        }

        // Renderizar gr√°ficos de efici√™ncia
        function renderEfficiencyCharts(efficiencyData) {
            // Gr√°fico de distribui√ß√£o da efici√™ncia
            renderEfficiencyDistributionChart(efficiencyData);
            
            // Gr√°fico das unidades mais eficientes
            renderTopEfficiencyChart(efficiencyData);
            
            // Gr√°fico das unidades menos eficientes
            renderBottomEfficiencyChart(efficiencyData);
            
            // Gr√°fico de efici√™ncia por tipo
            renderEfficiencyByTypeChart(efficiencyData);
        }

        // Gr√°fico de distribui√ß√£o da efici√™ncia
        function renderEfficiencyDistributionChart(efficiencyData) {
            const ctx = document.getElementById('efficiencyDistributionChart').getContext('2d');
            
            if (charts.efficiencyDistribution) {
                charts.efficiencyDistribution.destroy();
            }
            
            const efficientCount = efficiencyData.filter(item => item.status === 'high').length;
            const attentionCount = efficiencyData.filter(item => item.status === 'medium').length;
            const criticalCount = efficiencyData.filter(item => item.status === 'low').length;
            
            charts.efficiencyDistribution = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Eficiente (‚â•90%)', 'Aten√ß√£o (70-89%)', 'Cr√≠tico (<70%)'],
                    datasets: [{
                        data: [efficientCount, attentionCount, criticalCount],
                        backgroundColor: ['#28a745', '#ffc107', '#dc3545']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Gr√°fico das unidades mais eficientes
        function renderTopEfficiencyChart(efficiencyData) {
            const ctx = document.getElementById('topEfficiencyChart').getContext('2d');
            
            if (charts.topEfficiency) {
                charts.topEfficiency.destroy();
            }
            
            const topUnits = efficiencyData.slice(0, 10);
            const labels = topUnits.map(item => item.unit.name.substring(0, 15) + '...');
            const efficiencies = topUnits.map(item => item.efficiency);
            const colors = topUnits.map(item => 
                item.status === 'high' ? '#28a745' : 
                item.status === 'medium' ? '#ffc107' : '#dc3545'
            );
            
            charts.topEfficiency = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Efici√™ncia (%)',
                        data: efficiencies,
                        backgroundColor: colors
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Efici√™ncia (%)'
                            }
                        }
                    }
                }
            });
        }

        // Gr√°fico das unidades menos eficientes
        function renderBottomEfficiencyChart(efficiencyData) {
            const ctx = document.getElementById('bottomEfficiencyChart').getContext('2d');
            
            if (charts.bottomEfficiency) {
                charts.bottomEfficiency.destroy();
            }
            
            const bottomUnits = efficiencyData.slice(-10).reverse();
            const labels = bottomUnits.map(item => item.unit.name.substring(0, 15) + '...');
            const efficiencies = bottomUnits.map(item => item.efficiency);
            const colors = bottomUnits.map(item => 
                item.status === 'high' ? '#28a745' : 
                item.status === 'medium' ? '#ffc107' : '#dc3545'
            );
            
            charts.bottomEfficiency = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Efici√™ncia (%)',
                        data: efficiencies,
                        backgroundColor: colors
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Efici√™ncia (%)'
                            }
                        }
                    }
                }
            });
        }

        // Gr√°fico de efici√™ncia por tipo de unidade
        function renderEfficiencyByTypeChart(efficiencyData) {
            const ctx = document.getElementById('efficiencyByTypeChart').getContext('2d');
            
            if (charts.efficiencyByType) {
                charts.efficiencyByType.destroy();
            }
            
            const typeEfficiencies = {
                'UBS': [],
                'CAIS': [],
                'DEMAIS': []
            };
            
            efficiencyData.forEach(item => {
                typeEfficiencies[item.unit.type].push(item.efficiency);
            });
            
            const typeAverages = {
                'UBS': typeEfficiencies.UBS.length > 0 ? 
                    typeEfficiencies.UBS.reduce((a, b) => a + b, 0) / typeEfficiencies.UBS.length : 0,
                'CAIS': typeEfficiencies.CAIS.length > 0 ? 
                    typeEfficiencies.CAIS.reduce((a, b) => a + b, 0) / typeEfficiencies.CAIS.length : 0,
                'DEMAIS': typeEfficiencies.DEMAIS.length > 0 ? 
                    typeEfficiencies.DEMAIS.reduce((a, b) => a + b, 0) / typeEfficiencies.DEMAIS.length : 0
            };
            
            charts.efficiencyByType = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['UBS', 'CAIS', 'Demais'],
                    datasets: [{
                        label: 'Efici√™ncia M√©dia (%)',
                        data: [
                            Math.round(typeAverages.UBS),
                            Math.round(typeAverages.CAIS),
                            Math.round(typeAverages.DEMAIS)
                        ],
                        backgroundColor: ['#28a745', '#17a2b8', '#6c757d']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Efici√™ncia M√©dia (%)'
                            }
                        }
                    }
                }
            });
        }

        // Atualizar contadores
        function updateCounters() {
            document.getElementById('totalUnitsCount').textContent = unitsData.length;
            document.getElementById('totalProductsCount').textContent = productsList.length;
            
            // Calcular alertas cr√≠ticos
            let criticalCount = 0;
            unitsData.forEach(unit => {
                unit.products.forEach(product => {
                    if (product.status === 'danger') criticalCount++;
                });
            });
            document.getElementById('criticalAlerts').textContent = criticalCount;
            
            // Calcular sugest√µes
            let suggestionsCount = 0;
            unitsData.forEach(unit => {
                unit.products.forEach(product => {
                    if (product.suggestion) suggestionsCount++;
                });
            });
            document.getElementById('suggestionsCount').textContent = suggestionsCount;
        }

        // Atualizar dashboard com filtros
        function updateDashboard() {
            const type = filterType.value;
            updateSummaryTable(type);
            renderAllCharts(type);
        }

        // Renderizar todos os gr√°ficos
        function renderAllCharts(type = 'all') {
            renderStatusChart(type);
            renderProductsChart(type);
            renderTypeChart(type);
            renderTrendChart(type);
        }

        // Gr√°fico de status por unidade (Top 10)
        function renderStatusChart(type = 'all') {
            const ctx = document.getElementById('statusChart').getContext('2d');
            
            if (charts.status) {
                charts.status.destroy();
            }
            
            let filteredUnits = type === 'all' ? unitsData : unitsData.filter(unit => unit.type === type);
            
            // Ordenar por n√∫mero de produtos cr√≠ticos e pegar top 10
            filteredUnits = filteredUnits
                .sort((a, b) => {
                    const aCritical = a.products.filter(p => p.status === 'danger').length;
                    const bCritical = b.products.filter(p => p.status === 'danger').length;
                    return bCritical - aCritical;
                })
                .slice(0, 10);
            
            const unitNames = filteredUnits.map(unit => unit.name.substring(0, 15) + '...');
            const criticalCounts = filteredUnits.map(unit => 
                unit.products.filter(p => p.status === 'danger').length
            );
            const warningCounts = filteredUnits.map(unit => 
                unit.products.filter(p => p.status === 'warning').length
            );
            
            charts.status = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: unitNames,
                    datasets: [
                        {
                            label: 'Cr√≠tico',
                            data: criticalCounts,
                            backgroundColor: '#dc3545'
                        },
                        {
                            label: 'Aten√ß√£o',
                            data: warningCounts,
                            backgroundColor: '#ffc107'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'N√∫mero de Produtos'
                            }
                        }
                    }
                }
            });
        }

        // Gr√°fico de produtos mais faltantes
        function renderProductsChart(type = 'all') {
            const ctx = document.getElementById('productsChart').getContext('2d');
            
            if (charts.products) {
                charts.products.destroy();
            }
            
            const filteredUnits = type === 'all' ? unitsData : unitsData.filter(unit => unit.type === type);
            const productShortages = {};
            
            productsList.forEach(product => {
                productShortages[product] = 0;
            });
            
            filteredUnits.forEach(unit => {
                unit.products.forEach(product => {
                    if (product.status === 'danger') {
                        productShortages[product.name]++;
                    }
                });
            });
            
            const sortedProducts = Object.entries(productShortages)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 8);
            
            charts.products = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedProducts.map(item => item[0]),
                    datasets: [{
                        label: 'Unidades com Falta',
                        data: sortedProducts.map(item => item[1]),
                        backgroundColor: '#dc3545'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'N√∫mero de Unidades'
                            }
                        }
                    }
                }
            });
        }

        // Gr√°fico de distribui√ß√£o por tipo
        function renderTypeChart(type = 'all') {
            const ctx = document.getElementById('typeChart').getContext('2d');
            
            if (charts.type) {
                charts.type.destroy();
            }
            
            const typeData = {
                'UBS': { critical: 0, warning: 0, ok: 0 },
                'CAIS': { critical: 0, warning: 0, ok: 0 },
                'DEMAIS': { critical: 0, warning: 0, ok: 0 }
            };
            
            unitsData.forEach(unit => {
                unit.products.forEach(product => {
                    typeData[unit.type][product.status]++;
                });
            });
            
            charts.type = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['UBS', 'CAIS', 'Demais'],
                    datasets: [{
                        data: [
                            typeData.UBS.critical + typeData.UBS.warning + typeData.UBS.ok,
                            typeData.CAIS.critical + typeData.CAIS.warning + typeData.CAIS.ok,
                            typeData.DEMAIS.critical + typeData.DEMAIS.warning + typeData.DEMAIS.ok
                        ],
                        backgroundColor: ['#28a745', '#17a2b8', '#6c757d']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // Gr√°fico de tend√™ncia (√∫ltimos 6 meses)
        function renderTrendChart(type = 'all') {
            const ctx = document.getElementById('trendChart').getContext('2d');
            
            if (charts.trend) {
                charts.trend.destroy();
            }
            
            // Dados de exemplo para tend√™ncia (√∫ltimos 6 meses)
            const months = ['Abr/25', 'Mai/25', 'Jun/25', 'Jul/25', 'Ago/25', 'Set/25'];
            const criticalData = [12, 15, 18, 16, 20, 18];
            const warningData = [18, 20, 22, 25, 28, 27];
            
            charts.trend = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: 'Alertas Cr√≠ticos',
                            data: criticalData,
                            borderColor: '#dc3545',
                            backgroundColor: 'rgba(220, 53, 69, 0.1)',
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Alertas de Aten√ß√£o',
                            data: warningData,
                            borderColor: '#ffc107',
                            backgroundColor: 'rgba(255, 193, 7, 0.1)',
                            fill: true,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'N√∫mero de Alertas'
                            }
                        }
                    }
                }
            });
        }

        // Atualizar tabela de resumo (Top 10 solicitantes)
        function updateSummaryTable(type = 'all') {
            let filteredUnits = type === 'all' ? unitsData : unitsData.filter(unit => unit.type === type);
            
            // Ordenar por n√∫mero de produtos cr√≠ticos (mais solicitantes)
            filteredUnits = filteredUnits
                .sort((a, b) => {
                    const aCritical = a.products.filter(p => p.status === 'danger').length;
                    const bCritical = b.products.filter(p => p.status === 'danger').length;
                    return bCritical - aCritical;
                })
                .slice(0, 10);
            
            summaryTableBody.innerHTML = '';
            
            filteredUnits.forEach(unit => {
                const criticalCount = unit.products.filter(p => p.status === 'danger').length;
                const warningCount = unit.products.filter(p => p.status === 'warning').length;
                const suggestionsCount = unit.products.filter(p => p.suggestion).length;
                
                let overallStatus = 'ok';
                if (criticalCount > 3) {
                    overallStatus = 'danger';
                } else if (criticalCount > 0 || warningCount > 5) {
                    overallStatus = 'warning';
                }
                
                const typeClass = `type-${unit.type.toLowerCase()}`;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${unit.name}</td>
                    <td><span class="unit-type ${typeClass}">${unit.type}</span></td>
                    <td>${criticalCount}</td>
                    <td>${warningCount}</td>
                    <td>${suggestionsCount}</td>
                    <td><span class="status ${overallStatus}">${
                        overallStatus === 'ok' ? 'Normal' : 
                        overallStatus === 'warning' ? 'Aten√ß√£o' : 'Cr√≠tico'
                    }</span></td>
                    <td>${unit.lastUpdate}</td>
                `;
                
                summaryTableBody.appendChild(row);
            });
        }

        // Renderizar lista de unidades
        function renderUnitsList() {
            unitsListContainer.innerHTML = '';
            
            unitsData.forEach(unit => {
                const criticalCount = unit.products.filter(p => p.status === 'danger').length;
                const typeClass = `type-${unit.type.toLowerCase()}`;
                
                const unitItem = document.createElement('div');
                unitItem.className = 'unit-item';
                unitItem.innerHTML = `
                    <div><strong>${unit.name}</strong> <span class="unit-type ${typeClass}">${unit.type}</span></div>
                    <div style="font-size: 0.8rem; margin-top: 0.5rem;">
                        <span class="status ${criticalCount > 0 ? 'danger' : 'ok'}">${criticalCount} cr√≠ticos</span>
                    </div>
                `;
                
                unitItem.addEventListener('click', function() {
                    // Remover active de todos os itens
                    document.querySelectorAll('.unit-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    
                    // Adicionar active ao item clicado
                    this.classList.add('active');
                    
                    // Mostrar detalhes da unidade
                    showUnitDetails(unit);
                });
                
                unitsListContainer.appendChild(unitItem);
            });
        }

        // Mostrar detalhes da unidade
        function showUnitDetails(unit) {
            selectedUnitName.textContent = `${unit.name} - ${unit.type}`;
            
            unitProductsGrid.innerHTML = '';
            
            unit.products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                
                productCard.innerHTML = `
                    <div class="product-header">
                        <div class="product-name">${product.name}</div>
                        <span class="status ${product.status}">${
                            product.status === 'ok' ? 'Normal' : 
                            product.status === 'warning' ? 'Aten√ß√£o' : 'Cr√≠tico'
                        }</span>
                    </div>
                    <div class="product-data">
                        <div class="data-item">
                            <div class="data-label">Dispon√≠vel (Out/25)</div>
                            <div class="data-value">${product.current}</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">M√≠nimo Sugerido</div>
                            <div class="data-value">${product.minSuggested}</div>
                        </div>
                    </div>
                    ${product.suggestion ? `
                    <div class="suggestions">
                        <div class="data-label">Sugest√£o:</div>
                        <div class="suggestion-item">
                            ${product.suggestion} (Qtd: ${product.suggestedQty})
                        </div>
                    </div>
                    ` : ''}
                `;
                
                unitProductsGrid.appendChild(productCard);
            });
        }

        // Preencher filtro de produtos
        function populateProductFilter() {
            productsList.forEach(product => {
                const option = document.createElement('option');
                option.value = product;
                option.textContent = product;
                filterProduct.appendChild(option);
            });
        }

        // Renderizar tabela de produtos
        function renderProductsTable() {
            const selectedProduct = filterProduct.value;
            
            productsTableBody.innerHTML = '';
            
            productsList.forEach(productName => {
                if (selectedProduct !== 'all' && selectedProduct !== productName) return;
                
                let totalCurrent = 0;
                let totalMinSuggested = 0;
                let lowStockUnits = 0;
                let criticalUnits = 0;
                
                unitsData.forEach(unit => {
                    const product = unit.products.find(p => p.name === productName);
                    if (product) {
                        totalCurrent += product.current;
                        totalMinSuggested += product.minSuggested;
                        
                        if (product.status === 'warning') lowStockUnits++;
                        if (product.status === 'danger') criticalUnits++;
                    }
                });
                
                let overallStatus = 'ok';
                if (criticalUnits > unitsData.length * 0.3) {
                    overallStatus = 'danger';
                } else if (criticalUnits > 0 || lowStockUnits > unitsData.length * 0.4) {
                    overallStatus = 'warning';
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${productName}</td>
                    <td>${totalCurrent}</td>
                    <td>${totalMinSuggested}</td>
                    <td>${lowStockUnits}</td>
                    <td>${criticalUnits}</td>
                    <td><span class="status ${overallStatus}">${
                        overallStatus === 'ok' ? 'Normal' : 
                        overallStatus === 'warning' ? 'Aten√ß√£o' : 'Cr√≠tico'
                    }</span></td>
                `;
                
                productsTableBody.appendChild(row);
            });
            
            // Atualizar gr√°fico de distribui√ß√£o se estiver na tab de produtos
            if (document.getElementById('products').classList.contains('active')) {
                renderProductDistributionChart(selectedProduct);
            }
        }

        // Gr√°fico de distribui√ß√£o do produto
        function renderProductDistributionChart(productName = null) {
            const ctx = document.getElementById('productDistributionChart').getContext('2d');
            
            if (charts.productDistribution) {
                charts.productDistribution.destroy();
            }
            
            const selectedProduct = productName || filterProduct.value;
            
            if (selectedProduct === 'all') {
                // Mostrar gr√°fico para todos os produtos
                const productTotals = {};
                productsList.forEach(product => {
                    productTotals[product] = 0;
                    unitsData.forEach(unit => {
                        const unitProduct = unit.products.find(p => p.name === product);
                        if (unitProduct) {
                            productTotals[product] += unitProduct.current;
                        }
                    });
                });
                
                const sortedProducts = Object.entries(productTotals)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 10);
                
                charts.productDistribution = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: sortedProducts.map(item => item[0]),
                        datasets: [{
                            label: 'Total Dispon√≠vel',
                            data: sortedProducts.map(item => item[1]),
                            backgroundColor: '#1a5276'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Quantidade Total'
                                }
                            }
                        }
                    }
                });
            } else {
                // Mostrar gr√°fico para um produto espec√≠fico
                const unitData = [];
                const unitNames = [];
                
                unitsData.forEach(unit => {
                    const product = unit.products.find(p => p.name === selectedProduct);
                    if (product) {
                        unitData.push(product.current);
                        unitNames.push(unit.name.substring(0, 15) + '...');
                    }
                });
                
                charts.productDistribution = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: unitNames,
                        datasets: [{
                            label: `Estoque de ${selectedProduct}`,
                            data: unitData,
                            backgroundColor: unitData.map(value => 
                                value === 0 ? '#dc3545' : 
                                value < 2 ? '#ffc107' : '#28a745'
                            )
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Quantidade em Estoque'
                                }
                            }
                        }
                    }
                });
            }
        }

        // Atualizar dados em tempo real
        async function refreshDataHandler() {
            try {
                // Simular carregamento
                refreshData.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Atualizando...';
                refreshData.disabled = true;
                
                // Em uma implementa√ß√£o real, aqui voc√™ faria a chamada para a API do Google Sheets
                // const response = await fetch('SUA_URL_DA_API');
                // const realData = await response.json();
                
                // Simular delay de rede
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Simular dados atualizados (em produ√ß√£o, use os dados reais da API)
                unitsData.forEach(unit => {
                    // Simular pequenas varia√ß√µes nos dados
                    unit.products.forEach(product => {
                        const variation = Math.random() > 0.7 ? (Math.random() > 0.5 ? 1 : -1) : 0;
                        product.current = Math.max(0, product.current + variation);
                        
                        // Atualizar status
                        if (product.current === 0) {
                            product.status = "danger";
                        } else if (product.current < product.minSuggested) {
                            product.status = "warning";
                        } else {
                            product.status = "ok";
                        }
                    });
                    
                    // Atualizar timestamp
                    const now = new Date();
                    unit.lastUpdate = `${now.getDate()}/10/2025 - ${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
                });
                
                // Recarregar todos os dados e gr√°ficos
                updateDashboard();
                renderUnitsList();
                renderProductsTable();
                updateCounters();
                calculateEfficiency();
                
                refreshData.innerHTML = '<i class="fas fa-sync-alt"></i> Atualizar Dados em Tempo Real';
                refreshData.disabled = false;
                
                alert('Dados atualizados com sucesso em tempo real!');
            } catch (error) {
                alert('Erro ao carregar dados: ' + error.message);
                refreshData.innerHTML = '<i class="fas fa-sync-alt"></i> Atualizar Dados em Tempo Real';
                refreshData.disabled = false;
            }
        }

        // Inicializar gr√°ficos de an√°lise IA
        function initializeAnalysisCharts() {
            // Gr√°fico de efici√™ncia por tipo
            const efficiencyCtx = document.getElementById('efficiencyChart').getContext('2d');
            
            const typeEfficiency = {
                'UBS': Math.floor(Math.random() * 30) + 65,
                'CAIS': Math.floor(Math.random() * 25) + 70,
                'DEMAIS': Math.floor(Math.random() * 35) + 60
            };
            
            charts.efficiency = new Chart(efficiencyCtx, {
                type: 'bar',
                data: {
                    labels: ['UBS', 'CAIS', 'Demais'],
                    datasets: [{
                        label: 'Efici√™ncia de Estoque (%)',
                        data: [typeEfficiency.UBS, typeEfficiency.CAIS, typeEfficiency.DEMAIS],
                        backgroundColor: ['#28a745', '#17a2b8', '#6c757d']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Efici√™ncia (%)'
                            }
                        }
                    }
                }
            });

            // Gr√°fico de correla√ß√£o
            const correlationCtx = document.getElementById('correlationChart').getContext('2d');
            charts.correlation = new Chart(correlationCtx, {
                type: 'radar',
                data: {
                    labels: ['√ÅGUA SANIT√ÅRIA', '√ÅLCOOL 70%', 'DESINFETANTE', 'DETERGENTE', 'SACOS DE LIXO'],
                    datasets: [
                        {
                            label: 'UBS',
                            data: [65, 59, 80, 71, 56],
                            fill: true,
                            backgroundColor: 'rgba(40, 167, 69, 0.2)',
                            borderColor: 'rgb(40, 167, 69)',
                            pointBackgroundColor: 'rgb(40, 167, 69)'
                        },
                        {
                            label: 'CAIS',
                            data: [48, 78, 62, 69, 74],
                            fill: true,
                            backgroundColor: 'rgba(23, 162, 184, 0.2)',
                            borderColor: 'rgb(23, 162, 184)',
                            pointBackgroundColor: 'rgb(23, 162, 184)'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    elements: {
                        line: {
                            borderWidth: 3
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
