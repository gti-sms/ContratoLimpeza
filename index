<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Completo - Materiais de Limpeza SMS</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a5276;
            --primary-dark: #13405c;
            --primary-light: #2e86c1;
            --secondary: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --light: #f8f9fa;
            --dark: #343a40;
            --gray: #6c757d;
            --light-gray: #e9ecef;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            min-height: 100vh;
            color: var(--dark);
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            padding: 1.5rem 2rem;
            border-radius: 10px 10px 0 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .logo {
            font-size: 2.5rem;
        }
        
        .header-text h1 {
            font-size: 1.8rem;
            margin-bottom: 0.25rem;
        }
        
        .dashboard {
            background: white;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .tabs {
            display: flex;
            background: var(--light);
            border-bottom: 1px solid var(--light-gray);
        }
        
        .tab {
            padding: 1rem 1.5rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
            background: white;
        }
        
        .tab-content {
            display: none;
            padding: 2rem;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: var(--light);
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border-left: 4px solid var(--primary);
        }
        
        .stat-card h3 {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .chart-container {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            height: 300px;
        }
        
        .table-container {
            margin-top: 2rem;
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--light-gray);
        }
        
        th {
            background: var(--primary);
            color: white;
            position: sticky;
            top: 0;
        }
        
        tr:hover {
            background: rgba(26, 82, 118, 0.05);
        }
        
        .status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .ok { background: #d4edda; color: #155724; }
        .warning { background: #fff3cd; color: #856404; }
        .danger { background: #f8d7da; color: #721c24; }
        
        .controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        select, button {
            padding: 0.7rem 1rem;
            border: 1px solid var(--light-gray);
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        select {
            background: white;
            min-width: 200px;
        }
        
        button {
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: background 0.3s ease;
        }
        
        button:hover {
            background: var(--primary-dark);
        }
        
        .unit-details {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2rem;
        }
        
        .units-list {
            background: var(--light);
            border-radius: 8px;
            padding: 1.5rem;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .unit-item {
            padding: 1rem;
            margin-bottom: 0.5rem;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid var(--primary);
        }
        
        .unit-item:hover {
            background: #e9ecef;
        }
        
        .unit-item.active {
            background: var(--primary-light);
            color: white;
        }
        
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .product-card {
            background: white;
            border: 1px solid var(--light-gray);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .product-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .product-name {
            font-weight: bold;
            color: var(--primary);
        }
        
        .product-data {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .data-item {
            margin-bottom: 0.5rem;
        }
        
        .data-label {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        .data-value {
            font-weight: bold;
        }
        
        .suggestions {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--light-gray);
        }
        
        .suggestion-item {
            background: #e7f3ff;
            padding: 0.5rem;
            border-radius: 4px;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        
        .ai-insights {
            background: #f0f8ff;
            border-left: 4px solid var(--primary);
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 2rem;
        }
        
        .insight-item {
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #d1e7ff;
        }
        
        .insight-item:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }
        
        footer {
            text-align: center;
            padding: 2rem;
            color: var(--gray);
            margin-top: 2rem;
        }
        
        .unit-type {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 0.5rem;
        }
        
        .type-ubs { background: #d4edda; color: #155724; }
        .type-cais { background: #cce7ff; color: #004085; }
        .type-demais { background: #f8d7da; color: #721c24; }
        
        /* Novos estilos para efici√™ncia de estoque */
        .efficiency-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .efficiency-stat-card {
            background: var(--light);
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .efficiency-stat-card.efficient {
            border-left: 4px solid var(--secondary);
        }
        
        .efficiency-stat-card.attention {
            border-left: 4px solid var(--warning);
        }
        
        .efficiency-stat-card.critical {
            border-left: 4px solid var(--danger);
        }
        
        .efficiency-stat-card h3 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .efficiency-stat-card.efficient h3 {
            color: var(--secondary);
        }
        
        .efficiency-stat-card.attention h3 {
            color: var(--warning);
        }
        
        .efficiency-stat-card.critical h3 {
            color: var(--danger);
        }
        
        .efficiency-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .efficiency-high {
            background: #d4edda;
            color: #155724;
        }
        
        .efficiency-medium {
            background: #fff3cd;
            color: #856404;
        }
        
        .efficiency-low {
            background: #f8d7da;
            color: #721c24;
        }
        
        /* Novos estilos para exporta√ß√£o e sugest√µes */
        .export-section {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 2rem;
            border-left: 4px solid var(--primary);
        }
        
        .export-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        
        .export-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }
        
        .export-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .export-btn.secondary {
            background: var(--secondary);
        }
        
        .export-btn.secondary:hover {
            background: #218838;
        }
        
        .suggestions-table {
            width: 100%;
            margin-top: 1rem;
        }
        
        .suggestions-table th {
            background: var(--primary);
            color: white;
        }
        
        .response-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 1rem;
        }
        
        .contract-alert {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .contract-alert i {
            color: #f39c12;
            font-size: 1.5rem;
        }
        
        .responder-form {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 2rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 0.7rem;
            border: 1px solid var(--light-gray);
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .form-group textarea {
            height: 100px;
            resize: vertical;
        }
        
        @media (max-width: 1200px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .stats, .efficiency-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .unit-details {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .stats, .efficiency-stats {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1;
                min-width: 120px;
                text-align: center;
            }
            
            .export-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo-container">
                    <i class="fas fa-hand-holding-medical logo"></i>
                    <div class="header-text">
                        <h1>Painel Completo - Materiais de Limpeza</h1>
                        <p>Secretaria Municipal de Sa√∫de - Vis√£o Consolidada de Todas as Unidades</p>
                    </div>
                </div>
                <div class="header-stats">
                    <div style="text-align: center;">
                        <div style="font-size: 1.5rem; font-weight: bold;" id="totalUnits">55</div>
                        <div style="font-size: 0.8rem;">Unidades Monitoradas</div>
                    </div>
                </div>
            </div>
        </header>
        
        <div class="dashboard">
            <div class="tabs">
                <div class="tab active" data-tab="overview">Vis√£o Geral</div>
                <div class="tab" data-tab="efficiency">Efici√™ncia de Estoque</div>
                <div class="tab" data-tab="suggestions">Sugest√µes e Respostas</div>
                <div class="tab" data-tab="units">Unidades</div>
                <div class="tab" data-tab="products">Produtos</div>
                <div class="tab" data-tab="analysis">An√°lise IA</div>
                <div class="tab" data-tab="reports">Relat√≥rios</div>
            </div>
            
            <div class="tab-content active" id="overview">
                <div class="contract-alert">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>
                        <strong>Monitoramento de Entrega de Materiais</strong>
                        <p>Este painel monitora a adequa√ß√£o entre materiais disponibilizados e necessidades das unidades de sa√∫de</p>
                    </div>
                </div>
                
                <div class="controls">
                    <select id="filterType">
                        <option value="all">Todos os Tipos</option>
                        <option value="UBS">UBS</option>
                        <option value="CAIS">CAIS</option>
                        <option value="DEMAIS">Demais</option>
                    </select>
                    <button id="refreshData">
                        <i class="fas fa-sync-alt"></i> Atualizar Dados em Tempo Real
                    </button>
                </div>
                
                <div class="stats">
                    <div class="stat-card">
                        <h3 id="totalUnitsCount">55</h3>
                        <p>Unidades de Sa√∫de</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalProductsCount">23</h3>
                        <p>Tipos de Produtos</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="criticalAlerts">18</h3>
                        <p>Alertas Cr√≠ticos</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="suggestionsCount">42</h3>
                        <p>Sugest√µes Recebidas</p>
                    </div>
                </div>
                
                <div class="charts-grid">
                    <div class="chart-container">
                        <h3>Status do Estoque por Unidade (Top 10)</h3>
                        <canvas id="statusChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Produtos Mais Faltantes</h3>
                        <canvas id="productsChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Distribui√ß√£o por Tipo de Unidade</h3>
                        <canvas id="typeChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Evolu√ß√£o de Alertas (√öltimos 6 Meses)</h3>
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>
                
                <div class="table-container">
                    <h3>Top 10 Unidades com Mais Solicita√ß√µes</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Unidade</th>
                                <th>Tipo</th>
                                <th>Produtos Cr√≠ticos</th>
                                <th>Produtos em Aten√ß√£o</th>
                                <th>Sugest√µes</th>
                                <th>Status Geral</th>
                                <th>√öltima Atualiza√ß√£o</th>
                            </tr>
                        </thead>
                        <tbody id="summaryTableBody">
                            <!-- Dados preenchidos via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- ABA: Efici√™ncia de Estoque -->
            <div class="tab-content" id="efficiency">
                <h2><i class="fas fa-chart-line"></i> Efici√™ncia de Estoque por Unidade</h2>
                <p class="data-label" style="margin-bottom: 1.5rem;">An√°lise da adequa√ß√£o entre materiais disponibilizados e necessidades m√≠nimas sugeridas</p>
                
                <div class="contract-alert">
                    <i class="fas fa-clipboard-check"></i>
                    <div>
                        <strong>Indicador de Desempenho</strong>
                        <p>A efici√™ncia mede a propor√ß√£o entre materiais recebidos e necessidades reais das unidades</p>
                    </div>
                </div>
                
                <div class="efficiency-stats">
                    <div class="efficiency-stat-card efficient">
                        <h3 id="efficientUnits">0</h3>
                        <p>Unidades Eficientes</p>
                        <small>Efici√™ncia ‚â• 90%</small>
                    </div>
                    <div class="efficiency-stat-card attention">
                        <h3 id="attentionUnits">0</h3>
                        <p>Unidades em Aten√ß√£o</p>
                        <small>Efici√™ncia 70-89%</small>
                    </div>
                    <div class="efficiency-stat-card critical">
                        <h3 id="criticalUnits">0</h3>
                        <p>Unidades Cr√≠ticas</p>
                        <small>Efici√™ncia < 70%</small>
                    </div>
                </div>
                
                <div class="charts-grid">
                    <div class="chart-container">
                        <h3>Distribui√ß√£o da Efici√™ncia</h3>
                        <canvas id="efficiencyDistributionChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Top 10 Unidades Mais Eficientes</h3>
                        <canvas id="topEfficiencyChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Top 10 Unidades Menos Eficientes</h3>
                        <canvas id="bottomEfficiencyChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Efici√™ncia M√©dia por Tipo de Unidade</h3>
                        <canvas id="efficiencyByTypeChart"></canvas>
                    </div>
                </div>
                
                <div class="table-container">
                    <h3>Ranking de Efici√™ncia por Unidade</h3>
                    <table class="ranking-table">
                        <thead>
                            <tr>
                                <th>Posi√ß√£o</th>
                                <th>Unidade</th>
                                <th>Tipo</th>
                                <th>Efici√™ncia</th>
                                <th>Status</th>
                                <th>Produtos Analisados</th>
                            </tr>
                        </thead>
                        <tbody id="efficiencyTableBody">
                            <!-- Dados preenchidos via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- NOVA ABA: Sugest√µes e Respostas -->
            <div class="tab-content" id="suggestions">
                <h2><i class="fas fa-comments"></i> Sugest√µes e Respostas das Unidades</h2>
                <p class="data-label" style="margin-bottom: 1.5rem;">Registro completo de sugest√µes e feedback das unidades de sa√∫de</p>
                
                <div class="response-info">
                    <i class="fas fa-info-circle"></i>
                    <span>Total de <strong id="totalSuggestions">0</strong> sugest√µes recebidas de <strong id="unitsWithSuggestions">0</strong> unidades</span>
                </div>
                
                <div class="controls">
                    <select id="filterSuggestionUnit">
                        <option value="all">Todas as Unidades</option>
                        <!-- Op√ß√µes preenchidas via JavaScript -->
                    </select>
                    <select id="filterSuggestionStatus">
                        <option value="all">Todos os Status</option>
                        <option value="pending">Pendentes</option>
                        <option value="approved">Aprovadas</option>
                        <option value="rejected">Rejeitadas</option>
                    </select>
                </div>
                
                <div class="table-container">
                    <h3>Registro de Sugest√µes</h3>
                    <table class="suggestions-table">
                        <thead>
                            <tr>
                                <th>Unidade</th>
                                <th>Produto Sugerido</th>
                                <th>Quantidade</th>
                                <th>Data</th>
                                <th>Status</th>
                                <th>Resposta</th>
                                <th>Respons√°vel</th>
                            </tr>
                        </thead>
                        <tbody id="suggestionsTableBody">
                            <!-- Dados preenchidos via JavaScript -->
                        </tbody>
                    </table>
                </div>

                <!-- Formul√°rio para responder sugest√µes -->
                <div class="responder-form">
                    <h3><i class="fas fa-reply"></i> Responder Sugest√£o</h3>
                    <div class="form-group">
                        <label for="selectSuggestion">Selecionar Sugest√£o:</label>
                        <select id="selectSuggestion">
                            <option value="">Selecione uma sugest√£o para responder</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="responseStatus">Status da Resposta:</label>
                        <select id="responseStatus">
                            <option value="approved">Aprovada</option>
                            <option value="rejected">Rejeitada</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="responseText">Resposta:</label>
                        <textarea id="responseText" placeholder="Digite a resposta para a unidade..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="responseResponsible">Respons√°vel:</label>
                        <input type="text" id="responseResponsible" placeholder="Seu nome">
                    </div>
                    <button id="submitResponse" class="export-btn secondary">
                        <i class="fas fa-paper-plane"></i> Enviar Resposta
                    </button>
                </div>
                
                <div class="chart-container" style="height: 300px; margin-top: 2rem;">
                    <h3>Sugest√µes por Tipo de Unidade</h3>
                    <canvas id="suggestionsByTypeChart"></canvas>
                </div>
            </div>
            
            <div class="tab-content" id="units">
                <div class="unit-details">
                    <div class="units-list">
                        <h3>Lista de Unidades</h3>
                        <div id="unitsListContainer">
                            <!-- Lista de unidades preenchida via JavaScript -->
                        </div>
                    </div>
                    
                    <div class="unit-details-content">
                        <h3 id="selectedUnitName">Selecione uma unidade para ver detalhes</h3>
                        <div id="unitProductsGrid" class="product-grid">
                            <!-- Produtos da unidade selecionada -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="products">
                <div class="controls">
                    <select id="filterProduct">
                        <option value="all">Todos os Produtos</option>
                        <!-- Op√ß√µes preenchidas via JavaScript -->
                    </select>
                </div>
                
                <div class="table-container">
                    <h3>Detalhamento por Produto</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Produto</th>
                                <th>Total Dispon√≠vel</th>
                                <th>Total M√≠nimo Sugerido</th>
                                <th>Unidades com Estoque Baixo</th>
                                <th>Unidades com Estoque Cr√≠tico</th>
                                <th>Status Geral</th>
                            </tr>
                        </thead>
                        <tbody id="productsTableBody">
                            <!-- Dados preenchidos via JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <div class="chart-container" style="height: 400px; margin-top: 2rem;">
                    <h3>Distribui√ß√£o do Produto por Unidade</h3>
                    <canvas id="productDistributionChart"></canvas>
                </div>
            </div>
            
            <div class="tab-content" id="analysis">
                <h2>An√°lises e Insights por IA</h2>
                
                <div class="ai-insights">
                    <h3><i class="fas fa-robot"></i> Insights Inteligentes</h3>
                    
                    <div class="insight-item">
                        <h4>üìä Padr√µes de Entrega Identificados</h4>
                        <p>Unidades do tipo CAIS apresentam 25% mais efici√™ncia na distribui√ß√£o de √ÅLCOOL 70% comparado √†s UBS. Sugere-se revis√£o do modelo de distribui√ß√£o.</p>
                    </div>
                    
                    <div class="insight-item">
                        <h4>üö® Unidades com Maior Gap de Entrega</h4>
                        <p>5 unidades apresentam efici√™ncia abaixo de 50%: UBS Petr√≥polis (42%), UBS Independente (38%), Ambulat√≥rio Bela Vista (45%), Cais H√≠pica (48%) e UBS Jardim Am√©rica (41%).</p>
                    </div>
                    
                    <div class="insight-item">
                        <h4>üí° Sugest√µes Mais Frequentes</h4>
                        <p>"Escova para limpeza dos panos" aparece em 12 unidades, indicando necessidade n√£o atendida pelo fornecedor atual.</p>
                    </div>
                    
                    <div class="insight-item">
                        <h4>üìà Tend√™ncias de Consumo</h4>
                        <p>Previs√£o de aumento de 15% no consumo de DESINFETANTE para o pr√≥ximo trimestre. Recomenda-se ajuste nos pedidos.</p>
                    </div>
                    
                    <div class="insight-item">
                        <h4>üí∞ Impacto Financeiro</h4>
                        <p>Otimiza√ß√£o na distribui√ß√£o pode gerar economia de 18% atrav√©s da padroniza√ß√£o de pedidos entre unidades similares.</p>
                    </div>
                </div>
                
                <div class="charts-grid" style="margin-top: 2rem;">
                    <div class="chart-container">
                        <h3>Efici√™ncia de Estoque por Tipo</h3>
                        <canvas id="efficiencyChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Correla√ß√£o entre Produtos</h3>
                        <canvas id="correlationChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- NOVA ABA: Relat√≥rios -->
            <div class="tab-content" id="reports">
                <h2><i class="fas fa-file-pdf"></i> Relat√≥rios e Documenta√ß√£o</h2>
                <p class="data-label" style="margin-bottom: 1.5rem;">Gera√ß√£o de relat√≥rios completos para documenta√ß√£o e auditoria</p>
                
                <div class="contract-alert">
                    <i class="fas fa-file-contract"></i>
                    <div>
                        <strong>Documenta√ß√£o para Gest√£o Contratual</strong>
                        <p>Relat√≥rios completos para acompanhamento de desempenho e comprova√ß√£o de necessidades</p>
                    </div>
                </div>
                
                <div class="export-section">
                    <h3><i class="fas fa-download"></i> Exportar Relat√≥rios</h3>
                    <p>Gere relat√≥rios completos em PDF para documenta√ß√£o oficial</p>
                    
                    <div class="export-buttons">
                        <button class="export-btn" id="exportFullReport">
                            <i class="fas fa-file-pdf"></i> Relat√≥rio Completo
                        </button>
                        <button class="export-btn" id="exportEfficiencyReport">
                            <i class="fas fa-chart-bar"></i> Relat√≥rio de Efici√™ncia
                        </button>
                        <button class="export-btn" id="exportSuggestionsReport">
                            <i class="fas fa-comments"></i> Relat√≥rio de Sugest√µes
                        </button>
                        <button class="export-btn secondary" id="exportUnitReport">
                            <i class="fas fa-clinic-medical"></i> Relat√≥rio por Unidade
                        </button>
                    </div>
                </div>
                
                <div class="charts-grid" style="margin-top: 2rem;">
                    <div class="chart-container">
                        <h3>Resumo Executivo - Efici√™ncia</h3>
                        <div id="executiveSummary" style="padding: 1rem;">
                            <div class="efficiency-stats" style="grid-template-columns: 1fr; margin-bottom: 1rem;">
                                <div class="efficiency-stat-card efficient">
                                    <h3 id="executiveEfficient">0</h3>
                                    <p>Unidades com Entrega Adequada</p>
                                </div>
                            </div>
                            <p><strong>An√°lise:</strong> <span id="efficiencyAnalysis">Carregando an√°lise...</span></p>
                            <p><strong>Recomenda√ß√µes:</strong> <span id="efficiencyRecommendations">Carregando recomenda√ß√µes...</span></p>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <h3>Indicadores Chave</h3>
                        <canvas id="kpiChart"></canvas>
                    </div>
                </div>
                
                <div class="table-container">
                    <h3>Dados para Auditoria</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Indicador</th>
                                <th>Valor</th>
                                <th>Meta</th>
                                <th>Status</th>
                                <th>Varia√ß√£o</th>
                            </tr>
                        </thead>
                        <tbody id="auditTableBody">
                            <!-- Dados preenchidos via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Secretaria Municipal de Sa√∫de &copy; 2025 - Sistema de Controle de Materiais de Limpeza</p>
            <p>Painel de Monitoramento Completo - Dados em Tempo Real | Documenta√ß√£o para Gest√£o Contratual</p>
        </footer>
    </div>

    <script>
        // Dados completos de exemplo
        const productsList = [
            "√ÅGUA SANIT√ÅRIA 5L", "√ÅLCOOL IL 70%", "AROMATIZADOR AR AGRAD√ÅVEL 400ML", 
            "DESINFETANTE 5L", "DETERGENTE 500ML", "DETERGENTE 5L COLORADO",
            "ESPONJA DUPLA FACE 70X100", "FLANELA (30X40) BRANCA", "LUSTRA M√ìVEIS 200ML",
            "PANO DE CH√ÉO ALVEJADO 40X62", "PANO DE PRATO 45X75", "SAB√ÉO EM P√ì 1 KG",
            "SACO DE LIXO 100L 0,08 C/100", "SACO DE LIXO 20L 0,04 C/100", "SACO DE LIXO 60L 0,06 C/100",
            "SAP√ìLIO CREMOSO 250ML", "VASSOURA DE NYLON", "PASSADOR DE CERA",
            "RODO DE PL√ÅSTICO DUPLO 40CM", "P√Å DE LIXO PL√ÅSTICA CABO LONGO", 
            "ESCOVA SANIT√ÅRIA DE PL√ÅSTICO C/SUPORTE", "BALDE 08L PL√ÅSTICO", "CERA"
        ];

        // Gerar dados completos para todas as unidades
        const unitsData = [];
        const unitNames = [
            "Ambulat√≥rio Bela Vista", "Ambulat√≥rio Capinzal", "Ambulat√≥rio Especialidades", 
            "Ambulat√≥rio Pulador", "Ambulat√≥rio S√£o Valentin/S√£o Roque",
            "Cais Dr. Ant√¥nio Marinho Albuquerque ‚Äì Vila Lu√≠za", "Cais Dr. Cyrio Nacul ‚Äì Petr√≥polis",
            "Cais Dr. Erwin Crussius ‚Äì H√≠pica", "Cais Dr. Lu√≠s Augusto Hexsel ‚Äì Boqueir√£o",
            "Cais Dr. Lu√≠s Fragomeni ‚Äì S√£o Crist√≥v√£o", "Caps Ad", "Caps I", "Caps II",
            "Central de Vacinas", "Centro de Refer√™ncia de Sa√∫de da Mulher",
            "Centro de Refer√™ncia de Sa√∫de do Idoso", "Capne", "Coordenadoria de Vigil√¢ncia em Sa√∫de",
            "UBS 1¬∫ Centen√°rio", "UBS Adirbal Corralo", "UBS Adolfo Groth", "UBS Adriana Lirio ‚Äì Oper√°ria",
            "UBS Edu Villa de Azambuja (Caic)", "UBS Jaboticabal", "UBS Jer√¥nimo Coelho",
            "UBS Planaltina", "UBS Ricci", "UBS Santa Marta / UBS Don√°ria", "UBS S√£o Crist√≥v√£o",
            "UBS S√£o Luiz Gonzaga", "Farm√°cia Central", "SAMU", "Secretaria Municipal De Sa√∫de",
            "Servi√ßo de Atendimento Especializado ‚Äì SAE", "UBS Annes", "UBS Bom Recreio",
            "UBS Entre Rios", "UBS Independente", "UBS Ivo Ferreira", "UBS Nossa Senhora Aparecida",
            "UBS Parque Farroupilha", "UBS Petr√≥polis", "UBS Santa Rita", 
            "UBS Santo Ant√¥nio Da Pedreira", "UBS Vila Nova", "Ambulat√≥rio Sede Independ√™ncia",
            "UBS H√≠pica", "UBS Mattos", "UBS Nene Graef", "UBS S√£o Jos√©", "UBS Valinhos",
            "UBS Zachia", "UBS Jardim Am√©rica", "UBS Menino Deus", "UBS Nonoai", "UBS Prisional"
        ];

        // Classificar unidades por tipo
        function getUnitType(unitName) {
            if (unitName.includes('Cais') || unitName.includes('CAIS')) {
                return 'CAIS';
            } else if (unitName.includes('UBS') || unitName.includes('ESF')) {
                return 'UBS';
            } else {
                return 'DEMAIS';
            }
        }

        // Dados de sugest√µes com respostas
        const suggestionsData = [];

        // Gerar dados realistas para cada unidade
        unitNames.forEach((name, index) => {
            const unitType = getUnitType(name);
            const products = [];
            
            // Gerar algumas sugest√µes para a unidade
            const unitSuggestions = [];
            const suggestionCount = Math.floor(Math.random() * 3);
            
            for (let i = 0; i < suggestionCount; i++) {
                const suggestionProducts = [
                    "Escova (para limpeza dos panos)",
                    "Luvas de borracha",
                    "Balde adicional", 
                    "Pano de ch√£o extra",
                    "Vassoura reserva",
                    "Rodo extra",
                    "Luvas descart√°veis",
                    "M√°scaras de prote√ß√£o"
                ];
                
                const suggestion = {
                    id: suggestionsData.length + 1,
                    unitName: name,
                    product: suggestionProducts[Math.floor(Math.random() * suggestionProducts.length)],
                    quantity: Math.floor(Math.random() * 5) + 1,
                    date: `15/10/2025`,
                    status: 'pending',
                    response: "",
                    responsible: ""
                };
                
                suggestionsData.push(suggestion);
                unitSuggestions.push(suggestion);
            }
            
            productsList.forEach(productName => {
                const minSuggested = Math.floor(Math.random() * 5) + 1;
                const currentStock = Math.floor(Math.random() * (minSuggested + 3));
                let status = "ok";
                
                if (currentStock === 0) {
                    status = "danger";
                } else if (currentStock < minSuggested) {
                    status = "warning";
                }
                
                const hasSuggestion = Math.random() > 0.7;
                const suggestion = hasSuggestion ? 
                    ["Escova (para limpeza dos panos)", "Luvas de borracha", "Balde adicional", "Pano de ch√£o extra"][Math.floor(Math.random() * 4)] : "";
                
                const suggestedQty = hasSuggestion ? Math.floor(Math.random() * 3) + 1 : 0;
                
                products.push({
                    name: productName,
                    current: currentStock,
                    minSuggested: minSuggested,
                    status: status,
                    suggestion: suggestion,
                    suggestedQty: suggestedQty
                });
            });
            
            unitsData.push({
                id: index + 1,
                name: name,
                type: unitType,
                products: products,
                lastUpdate: `15/10/2025 - ${Math.floor(Math.random() * 24)}:${Math.floor(Math.random() * 60).toString().padStart(2, '0')}`,
                suggestions: unitSuggestions
            });
        });

        // Elementos DOM
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const filterType = document.getElementById('filterType');
        const refreshData = document.getElementById('refreshData');
        const filterProduct = document.getElementById('filterProduct');
        const unitsListContainer = document.getElementById('unitsListContainer');
        const selectedUnitName = document.getElementById('selectedUnitName');
        const unitProductsGrid = document.getElementById('unitProductsGrid');
        const summaryTableBody = document.getElementById('summaryTableBody');
        const productsTableBody = document.getElementById('productsTableBody');
        const efficiencyTableBody = document.getElementById('efficiencyTableBody');
        const efficientUnits = document.getElementById('efficientUnits');
        const attentionUnits = document.getElementById('attentionUnits');
        const criticalUnits = document.getElementById('criticalUnits');
        const suggestionsTableBody = document.getElementById('suggestionsTableBody');
        const totalSuggestions = document.getElementById('totalSuggestions');
        const unitsWithSuggestions = document.getElementById('unitsWithSuggestions');
        const filterSuggestionUnit = document.getElementById('filterSuggestionUnit');
        const filterSuggestionStatus = document.getElementById('filterSuggestionStatus');
        const selectSuggestion = document.getElementById('selectSuggestion');
        const responseStatus = document.getElementById('responseStatus');
        const responseText = document.getElementById('responseText');
        const responseResponsible = document.getElementById('responseResponsible');
        const submitResponse = document.getElementById('submitResponse');
        
        // Bot√µes de exporta√ß√£o
        const exportFullReport = document.getElementById('exportFullReport');
        const exportEfficiencyReport = document.getElementById('exportEfficiencyReport');
        const exportSuggestionsReport = document.getElementById('exportSuggestionsReport');
        const exportUnitReport = document.getElementById('exportUnitReport');
        
        // Vari√°veis para gr√°ficos
        let charts = {};

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            setupEventListeners();
            renderAllCharts();
            updateSummaryTable();
            renderUnitsList();
            renderProductsTable();
            populateProductFilter();
            calculateEfficiency();
            renderSuggestionsTab();
            setupExportButtons();
            setupResponseForm();
        });

        // Configurar formul√°rio de resposta
        function setupResponseForm() {
            // Preencher select de sugest√µes
            selectSuggestion.innerHTML = '<option value="">Selecione uma sugest√£o para responder</option>';
            suggestionsData.filter(s => s.status === 'pending').forEach(suggestion => {
                const option = document.createElement('option');
                option.value = suggestion.id;
                option.textContent = `${suggestion.unitName} - ${suggestion.product} (Qtd: ${suggestion.quantity})`;
                selectSuggestion.appendChild(option);
            });

            // Configurar envio de resposta
            submitResponse.addEventListener('click', function() {
                const suggestionId = parseInt(selectSuggestion.value);
                const status = responseStatus.value;
                const text = responseText.value.trim();
                const responsible = responseResponsible.value.trim();

                if (!suggestionId) {
                    alert('Selecione uma sugest√£o para responder');
                    return;
                }

                if (!text) {
                    alert('Digite uma resposta');
                    return;
                }

                if (!responsible) {
                    alert('Informe o respons√°vel pela resposta');
                    return;
                }

                // Encontrar e atualizar sugest√£o
                const suggestion = suggestionsData.find(s => s.id === suggestionId);
                if (suggestion) {
                    suggestion.status = status;
                    suggestion.response = text;
                    suggestion.responsible = responsible;

                    // Atualizar interface
                    renderSuggestionsTable();
                    updateResponseForm();

                    alert('Resposta enviada com sucesso!');
                }
            });
        }

        // Atualizar formul√°rio de resposta
        function updateResponseForm() {
            responseText.value = '';
            responseResponsible.value = '';
            selectSuggestion.innerHTML = '<option value="">Selecione uma sugest√£o para responder</option>';
            suggestionsData.filter(s => s.status === 'pending').forEach(suggestion => {
                const option = document.createElement('option');
                option.value = suggestion.id;
                option.textContent = `${suggestion.unitName} - ${suggestion.product} (Qtd: ${suggestion.quantity})`;
                selectSuggestion.appendChild(option);
            });
        }

        // Configurar bot√µes de exporta√ß√£o
        function setupExportButtons() {
            exportFullReport.addEventListener('click', () => exportToPDF('full'));
            exportEfficiencyReport.addEventListener('click', () => exportToPDF('efficiency'));
            exportSuggestionsReport.addEventListener('click', () => exportToPDF('suggestions'));
            exportUnitReport.addEventListener('click', () => exportToPDF('unit'));
        }

        // Exportar para PDF
        async function exportToPDF(type) {
            try {
                const btn = event.target;
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Gerando PDF...';
                btn.disabled = true;
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                let yPosition = 20;
                
                // Cabe√ßalho
                doc.setFontSize(20);
                doc.setTextColor(26, 82, 118);
                doc.text('Relat√≥rio - Materiais de Limpeza SMS', 20, yPosition);
                yPosition += 10;
                
                doc.setFontSize(12);
                doc.setTextColor(100, 100, 100);
                doc.text('Secretaria Municipal de Sa√∫de', 20, yPosition);
                yPosition += 8;
                doc.text(`Gerado em: ${new Date().toLocaleDateString('pt-BR')}`, 20, yPosition);
                yPosition += 20;
                
                switch(type) {
                    case 'full':
                        await generateFullReport(doc, yPosition);
                        break;
                    case 'efficiency':
                        await generateEfficiencyReport(doc, yPosition);
                        break;
                    case 'suggestions':
                        await generateSuggestionsReport(doc, yPosition);
                        break;
                    case 'unit':
                        await generateUnitReport(doc, yPosition);
                        break;
                }
                
                doc.save(`relatorio_${type}_${new Date().toISOString().split('T')[0]}.pdf`);
                
                btn.innerHTML = originalText;
                btn.disabled = false;
                
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                alert('Erro ao gerar relat√≥rio PDF');
                const btn = event.target;
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        // Gerar relat√≥rio completo
        async function generateFullReport(doc, yPosition) {
            doc.setFontSize(16);
            doc.setTextColor(0, 0, 0);
            doc.text('Relat√≥rio Completo - Situa√ß√£o do Estoque', 20, yPosition);
            yPosition += 20;
            
            doc.setFontSize(12);
            doc.text(`Total de Unidades: ${unitsData.length}`, 20, yPosition);
            yPosition += 8;
            doc.text(`Total de Produtos: ${productsList.length}`, 20, yPosition);
            yPosition += 8;
            doc.text(`Unidades com Efici√™ncia ‚â• 90%: ${document.getElementById('efficientUnits').textContent}`, 20, yPosition);
            yPosition += 8;
            doc.text(`Unidades com Efici√™ncia < 70%: ${document.getElementById('criticalUnits').textContent}`, 20, yPosition);
            yPosition += 20;
            
            // Adicionar mais se√ß√µes...
        }

        // Gerar relat√≥rio de efici√™ncia
        async function generateEfficiencyReport(doc, yPosition) {
            doc.setFontSize(16);
            doc.setTextColor(0, 0, 0);
            doc.text('Relat√≥rio de Efici√™ncia de Estoque', 20, yPosition);
            yPosition += 20;
            
            const efficiencyData = calculateEfficiencyData();
            
            doc.setFontSize(12);
            doc.text('Ranking das Unidades por Efici√™ncia:', 20, yPosition);
            yPosition += 15;
            
            efficiencyData.slice(0, 10).forEach((item, index) => {
                if (yPosition > 270) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                doc.text(`${index + 1}. ${item.unit.name} - ${item.efficiency}%`, 25, yPosition);
                yPosition += 7;
            });
        }

        // Gerar relat√≥rio de sugest√µes
        async function generateSuggestionsReport(doc, yPosition) {
            doc.setFontSize(16);
            doc.setTextColor(0, 0, 0);
            doc.text('Relat√≥rio de Sugest√µes das Unidades', 20, yPosition);
            yPosition += 20;
            
            doc.setFontSize(12);
            suggestionsData.forEach((suggestion, index) => {
                if (yPosition > 270) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                doc.text(`${suggestion.unitName}`, 20, yPosition);
                yPosition += 6;
                doc.text(`Sugest√£o: ${suggestion.product} (Qtd: ${suggestion.quantity})`, 25, yPosition);
                yPosition += 6;
                doc.text(`Status: ${suggestion.status === 'pending' ? 'Pendente' : suggestion.status === 'approved' ? 'Aprovada' : 'Rejeitada'}`, 25, yPosition);
                yPosition += 6;
                
                if (suggestion.response) {
                    doc.text(`Resposta: ${suggestion.response}`, 25, yPosition);
                    yPosition += 6;
                }
                
                yPosition += 5;
            });
        }

        // Gerar relat√≥rio por unidade
        async function generateUnitReport(doc, yPosition) {
            doc.setFontSize(16);
            doc.setTextColor(0, 0, 0);
            doc.text('Relat√≥rio por Unidade - Materiais em Falta', 20, yPosition);
            yPosition += 20;
            
            const criticalUnits = unitsData.filter(unit => 
                unit.products.some(product => product.status === 'danger')
            );
            
            doc.setFontSize(12);
            criticalUnits.forEach((unit, index) => {
                if (yPosition > 270) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                const criticalProducts = unit.products.filter(p => p.status === 'danger');
                
                doc.text(`${unit.name} (${unit.type})`, 20, yPosition);
                yPosition += 8;
                doc.text(`Produtos em falta: ${criticalProducts.length}`, 25, yPosition);
                yPosition += 6;
                
                criticalProducts.forEach(product => {
                    if (yPosition > 270) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    doc.text(`- ${product.name}`, 30, yPosition);
                    yPosition += 6;
                });
                
                yPosition += 10;
            });
        }

        // Calcular dados de efici√™ncia
        function calculateEfficiencyData() {
            return unitsData.map(unit => {
                let totalCurrent = 0;
                let totalMinSuggested = 0;
                let productsAnalyzed = 0;
                
                unit.products.forEach(product => {
                    if (product.minSuggested > 0) {
                        totalCurrent += product.current;
                        totalMinSuggested += product.minSuggested;
                        productsAnalyzed++;
                    }
                });
                
                const efficiency = totalMinSuggested > 0 ? (totalCurrent / totalMinSuggested) * 100 : 100;
                
                let efficiencyStatus = 'high';
                if (efficiency < 70) {
                    efficiencyStatus = 'low';
                } else if (efficiency < 90) {
                    efficiencyStatus = 'medium';
                }
                
                return {
                    unit: unit,
                    efficiency: Math.round(efficiency),
                    status: efficiencyStatus,
                    productsAnalyzed: productsAnalyzed
                };
            }).sort((a, b) => b.efficiency - a.efficiency);
        }

        // Renderizar aba de sugest√µes
        function renderSuggestionsTab() {
            totalSuggestions.textContent = suggestionsData.length;
            
            const unitsWithSugs = new Set(suggestionsData.map(s => s.unitName)).size;
            unitsWithSuggestions.textContent = unitsWithSugs;
            
            filterSuggestionUnit.innerHTML = '<option value="all">Todas as Unidades</option>';
            unitNames.forEach(unit => {
                const option = document.createElement('option');
                option.value = unit;
                option.textContent = unit;
                filterSuggestionUnit.appendChild(option);
            });
            
            renderSuggestionsTable();
            renderSuggestionsChart();
            
            filterSuggestionUnit.addEventListener('change', renderSuggestionsTable);
            filterSuggestionStatus.addEventListener('change', renderSuggestionsTable);
        }

        // Renderizar tabela de sugest√µes
        function renderSuggestionsTable() {
            const unitFilter = filterSuggestionUnit.value;
            const statusFilter = filterSuggestionStatus.value;
            
            let filteredSuggestions = suggestionsData;
            
            if (unitFilter !== 'all') {
                filteredSuggestions = filteredSuggestions.filter(s => s.unitName === unitFilter);
            }
            
            if (statusFilter !== 'all') {
                filteredSuggestions = filteredSuggestions.filter(s => s.status === statusFilter);
            }
            
            suggestionsTableBody.innerHTML = '';
            
            filteredSuggestions.forEach(suggestion => {
                const row = document.createElement('tr');
                
                const statusText = suggestion.status === 'pending' ? 'Pendente' : 
                                 suggestion.status === 'approved' ? 'Aprovada' : 'Rejeitada';
                
                const statusClass = suggestion.status === 'pending' ? 'warning' : 
                                  suggestion.status === 'approved' ? 'ok' : 'danger';
                
                row.innerHTML = `
                    <td>${suggestion.unitName}</td>
                    <td>${suggestion.product}</td>
                    <td>${suggestion.quantity}</td>
                    <td>${suggestion.date}</td>
                    <td><span class="status ${statusClass}">${statusText}</span></td>
                    <td>${suggestion.response || '-'}</td>
                    <td>${suggestion.responsible || '-'}</td>
                `;
                
                suggestionsTableBody.appendChild(row);
            });
        }

        // Renderizar gr√°fico de sugest√µes por tipo
        function renderSuggestionsChart() {
            const ctx = document.getElementById('suggestionsByTypeChart').getContext('2d');
            
            if (charts.suggestionsByType) {
                charts.suggestionsByType.destroy();
            }
            
            const typeCounts = {
                'UBS': { pending: 0, approved: 0, rejected: 0 },
                'CAIS': { pending: 0, approved: 0, rejected: 0 },
                'DEMAIS': { pending: 0, approved: 0, rejected: 0 }
            };
            
            suggestionsData.forEach(suggestion => {
                const unit = unitsData.find(u => u.name === suggestion.unitName);
                if (unit) {
                    typeCounts[unit.type][suggestion.status]++;
                }
            });
            
            charts.suggestionsByType = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['UBS', 'CAIS', 'Demais'],
                    datasets: [
                        {
                            label: 'Pendentes',
                            data: [typeCounts.UBS.pending, typeCounts.CAIS.pending, typeCounts.DEMAIS.pending],
                            backgroundColor: '#ffc107'
                        },
                        {
                            label: 'Aprovadas',
                            data: [typeCounts.UBS.approved, typeCounts.CAIS.approved, typeCounts.DEMAIS.approved],
                            backgroundColor: '#28a745'
                        },
                        {
                            label: 'Rejeitadas',
                            data: [typeCounts.UBS.rejected, typeCounts.CAIS.rejected, typeCounts.DEMAIS.rejected],
                            backgroundColor: '#dc3545'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'N√∫mero de Sugest√µes'
                            }
                        }
                    }
                }
            });
        }

        // [Restante das fun√ß√µes permanecem iguais...]
        // initializeDashboard, setupEventListeners, updateCounters, updateDashboard, renderAllCharts,
        // renderStatusChart, renderProductsChart, renderTypeChart, renderTrendChart, updateSummaryTable,
        // renderUnitsList, showUnitDetails, populateProductFilter, renderProductsTable, 
        // renderProductDistributionChart, calculateEfficiency, updateEfficiencyCounters, 
        // updateEfficiencyTable, renderEfficiencyCharts, renderEfficiencyDistributionChart,
        // renderTopEfficiencyChart, renderBottomEfficiencyChart, renderEfficiencyByTypeChart,
        // refreshDataHandler, initializeAnalysisCharts, updateReportsTab

        // Inicializar dashboard
        function initializeDashboard() {
            updateCounters();
        }

        // Configurar event listeners
        function setupEventListeners() {
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    this.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                    
                    if (tabId === 'products') {
                        renderProductDistributionChart();
                    } else if (tabId === 'analysis') {
                        if (!charts.efficiency) {
                            setTimeout(initializeAnalysisCharts, 100);
                        }
                    } else if (tabId === 'efficiency') {
                        calculateEfficiency();
                    } else if (tabId === 'suggestions') {
                        renderSuggestionsTab();
                    } else if (tabId === 'reports') {
                        updateReportsTab();
                    }
                });
            });

            filterType.addEventListener('change', updateDashboard);
            refreshData.addEventListener('click', refreshDataHandler);
            filterProduct.addEventListener('change', renderProductsTable);
        }

        // Atualizar aba de relat√≥rios
        function updateReportsTab() {
            const efficiencyData = calculateEfficiencyData();
            const efficientCount = efficiencyData.filter(item => item.status === 'high').length;
            
            document.getElementById('executiveEfficient').textContent = efficientCount;
            document.getElementById('efficiencyAnalysis').textContent = 
                `${efficientCount} unidades (${Math.round(efficientCount/unitsData.length*100)}%) apresentam entrega adequada de materiais`;
            
            document.getElementById('efficiencyRecommendations').textContent = 
                `Recomenda-se revis√£o do contrato para as ${unitsData.length - efficientCount} unidades com efici√™ncia abaixo de 90%`;

            // Atualizar gr√°fico KPI
            renderKPIChart();
            updateAuditTable();
        }

        // Renderizar gr√°fico KPI
        function renderKPIChart() {
            const ctx = document.getElementById('kpiChart').getContext('2d');
            
            if (charts.kpi) {
                charts.kpi.destroy();
            }
            
            const efficiencyData = calculateEfficiencyData();
            const efficientCount = efficiencyData.filter(item => item.status === 'high').length;
            const attentionCount = efficiencyData.filter(item => item.status === 'medium').length;
            const criticalCount = efficiencyData.filter(item => item.status === 'low').length;
            
            charts.kpi = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Eficientes', 'Aten√ß√£o', 'Cr√≠ticas'],
                    datasets: [{
                        data: [efficientCount, attentionCount, criticalCount],
                        backgroundColor: ['#28a745', '#ffc107', '#dc3545']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Atualizar tabela de auditoria
        function updateAuditTable() {
            const auditTableBody = document.getElementById('auditTableBody');
            auditTableBody.innerHTML = '';
            
            const efficiencyData = calculateEfficiencyData();
            const avgEfficiency = efficiencyData.reduce((sum, item) => sum + item.efficiency, 0) / efficiencyData.length;
            const pendingSuggestions = suggestionsData.filter(s => s.status === 'pending').length;
            const criticalProducts = unitsData.reduce((sum, unit) => sum + unit.products.filter(p => p.status === 'danger').length, 0);
            
            const auditData = [
                { indicator: 'Efici√™ncia M√©dia', value: `${Math.round(avgEfficiency)}%`, target: '‚â•90%', status: avgEfficiency >= 90 ? 'ok' : 'danger', variation: `${Math.round(avgEfficiency - 90)}%` },
                { indicator: 'Sugest√µes Pendentes', value: pendingSuggestions, target: '‚â§5', status: pendingSuggestions <= 5 ? 'ok' : 'warning', variation: `${pendingSuggestions - 5}` },
                { indicator: 'Produtos Cr√≠ticos', value: criticalProducts, target: '‚â§10', status: criticalProducts <= 10 ? 'ok' : 'danger', variation: `${criticalProducts - 10}` },
                { indicator: 'Unidades Eficientes', value: document.getElementById('efficientUnits').textContent, target: '‚â•80%', status: efficientCount >= unitsData.length * 0.8 ? 'ok' : 'warning', variation: `${efficientCount - Math.round(unitsData.length * 0.8)}` }
            ];
            
            auditData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.indicator}</td>
                    <td>${item.value}</td>
                    <td>${item.target}</td>
                    <td><span class="status ${item.status}">${item.status === 'ok' ? 'Dentro' : item.status === 'warning' ? 'Aten√ß√£o' : 'Fora'}</span></td>
                    <td>${item.variation}</td>
                `;
                auditTableBody.appendChild(row);
            });
        }

        // [As demais fun√ß√µes do c√≥digo anterior permanecem aqui...]
        // Fun√ß√µes para gr√°ficos, c√°lculos de efici√™ncia, etc.

    </script>
</body>
</html>
